<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Inimigos da Bola — 2026</title>
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,600;0,9..40,800;1,9..40,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #080c10;
  --surface: #0d1117;
  --surface2: #161b22;
  --surface3: #21262d;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(255,255,255,0.14);
  --accent: #00e5ff;
  --accent2: #7c3aed;
  --accent3: #f59e0b;
  --green: #22c55e;
  --red: #ef4444;
  --text: #e6edf3;
  --text2: #8b949e;
  --text3: #484f58;
  --boca: #3b82f6;
  --river: #ef4444;
  --font-display: 'Bebas Neue', sans-serif;
  --font-body: 'DM Sans', sans-serif;
  --font-mono: 'Space Mono', monospace;
  --r: 12px;
  --r2: 8px;
  --glow-cyan: 0 0 20px rgba(0,229,255,0.3);
  --glow-purple: 0 0 20px rgba(124,58,237,0.3);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body { height: 100%; overflow: hidden; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
}

/* Grain overlay */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 9999;
  opacity: 0.4;
}

/* Scrollbars */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--surface3); border-radius: 4px; }

/* ==============================
   TOPBAR
============================== */
#topbar {
  height: 56px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  flex-shrink: 0;
  position: relative;
  z-index: 100;
}

.topbar-logo {
  display: flex;
  align-items: center;
  gap: 10px;
}
.topbar-logo-icon {
  width: 32px; height: 32px;
  background: linear-gradient(135deg, var(--accent2), var(--accent));
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: #fff;
  box-shadow: var(--glow-cyan);
}
.topbar-logo h1 {
  font-family: var(--font-display);
  font-size: 22px;
  letter-spacing: 2px;
  color: var(--text);
  line-height: 1;
}
.topbar-logo span {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--accent);
  letter-spacing: 3px;
  display: block;
  margin-top: -2px;
}

.topbar-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.topbar-filter {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--r2);
  padding: 6px 12px;
  color: var(--text);
  font-family: var(--font-mono);
  font-size: 11px;
  cursor: pointer;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  min-width: 200px;
}

.topbar-search-wrap {
  position: relative;
}
.topbar-search-wrap i {
  position: absolute;
  left: 10px; top: 50%;
  transform: translateY(-50%);
  color: var(--text3); font-size: 11px;
}
#player-search {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  padding: 6px 12px 6px 30px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 13px;
  outline: none;
  width: 180px;
  transition: border-color 0.2s, width 0.3s;
}
#player-search:focus { border-color: var(--accent); width: 220px; }

.btn-icon {
  width: 34px; height: 34px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  color: var(--text2);
  font-size: 13px;
  transition: all 0.2s;
}
.btn-icon:hover { background: var(--surface3); color: var(--text); border-color: var(--border2); }

#mobile-menu-btn { display: none; }

/* ==============================
   LAYOUT
============================== */
#layout {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* ==============================
   SIDEBAR
============================== */
#sidebar {
  width: 220px;
  flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 16px 12px;
  gap: 4px;
}

.nav-section-label {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 3px;
  text-transform: uppercase;
  padding: 12px 8px 6px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 10px;
  border-radius: var(--r2);
  cursor: pointer;
  color: var(--text2);
  font-size: 13px;
  font-weight: 600;
  transition: all 0.15s;
  border: 1px solid transparent;
  position: relative;
  overflow: hidden;
  white-space: nowrap;
}
.nav-item:hover { background: var(--surface2); color: var(--text); }
.nav-item.active {
  background: rgba(0,229,255,0.08);
  color: var(--accent);
  border-color: rgba(0,229,255,0.2);
}
.nav-item.active::before {
  content: '';
  position: absolute;
  left: 0; top: 20%; bottom: 20%;
  width: 2px;
  background: var(--accent);
  border-radius: 0 2px 2px 0;
  box-shadow: 0 0 8px var(--accent);
}
.nav-item i { width: 16px; text-align: center; font-size: 12px; }
.nav-item.tool { color: var(--text3); }
.nav-item.tool:hover { color: var(--text2); }

/* ==============================
   MAIN CONTENT
============================== */
#main {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 24px;
}

.tab-content { display: none; animation: fadeIn 0.25s ease; }
.tab-content.active { display: block; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* ==============================
   CARDS / PANELS
============================== */
.panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
}
.panel:hover { border-color: var(--border2); }

.panel-header {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--surface2);
}
.panel-title {
  font-family: var(--font-display);
  font-size: 15px;
  letter-spacing: 1.5px;
  color: var(--text);
}
.panel-subtitle {
  font-size: 11px;
  color: var(--text3);
  font-family: var(--font-mono);
}

/* ==============================
   HUB TAB
============================== */
.hub-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 16px;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s;
}
.stat-card:hover { border-color: var(--border2); transform: translateY(-2px); }
.stat-card::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 60%, rgba(255,255,255,0.02));
  pointer-events: none;
}
.stat-card-label {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.stat-card-main {
  display: flex;
  align-items: center;
  gap: 10px;
}
.stat-card-img {
  width: 40px; height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--border2);
  background: var(--surface2);
}
.stat-card-name {
  font-family: var(--font-display);
  font-size: 18px;
  letter-spacing: 1px;
  color: var(--text);
  line-height: 1;
}
.stat-card-val {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text2);
  margin-top: 2px;
}
.stat-card-accent {
  position: absolute;
  top: 0; right: 0;
  width: 3px;
  height: 100%;
  border-radius: 0 var(--r) var(--r) 0;
}

/* MVP HERO */
#hero-section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 20px;
  margin-bottom: 24px;
  display: none;
  position: relative;
  overflow: hidden;
}
#hero-section::before {
  content: '';
  position: absolute;
  top: -50%; right: -10%;
  width: 300px; height: 300px;
  background: radial-gradient(circle, rgba(124,58,237,0.15) 0%, transparent 70%);
  pointer-events: none;
}
.hero-inner {
  display: flex;
  align-items: center;
  gap: 20px;
  position: relative;
  z-index: 1;
}
.hero-photo-wrap {
  position: relative; flex-shrink: 0;
}
#hero-img {
  width: 80px; height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--accent3);
  box-shadow: 0 0 20px rgba(245,158,11,0.4);
}
.hero-mvp-tag {
  position: absolute;
  bottom: -6px; left: 50%;
  transform: translateX(-50%);
  background: var(--accent3);
  color: #000;
  font-family: var(--font-mono);
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 1px;
  padding: 2px 8px;
  border-radius: 999px;
  white-space: nowrap;
}
.hero-info { flex: 1; }
.hero-label {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--accent3);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 4px;
}
#hero-name {
  font-family: var(--font-display);
  font-size: 40px;
  letter-spacing: 3px;
  color: var(--text);
  line-height: 1;
  margin-bottom: 8px;
}
.hero-stats {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}
.hero-stat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text2);
}
.hero-stat i { color: var(--accent3); font-size: 10px; }
.hero-rating-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  padding: 12px 20px;
  text-align: center;
  flex-shrink: 0;
}
.hero-rating-label {
  font-family: var(--font-mono);
  font-size: 8px;
  color: var(--text3);
  letter-spacing: 2px;
  display: block;
  margin-bottom: 4px;
}
#hero-rating {
  font-family: var(--font-display);
  font-size: 44px;
  color: var(--text);
  letter-spacing: 2px;
  line-height: 1;
}

/* ==============================
   RANKINGS GRID
============================== */
#rankings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 14px;
}

.rank-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  transition: border-color 0.2s;
}
.rank-card:hover { border-color: var(--border2); }
.rank-card-header {
  padding: 10px 14px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.rank-card-title {
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text3);
  text-transform: uppercase;
}
.rank-card-icon { font-size: 11px; }
.rank-row {
  display: flex;
  align-items: center;
  padding: 7px 12px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.15s;
  gap: 10px;
}
.rank-row:last-child { border-bottom: none; }
.rank-row:hover { background: var(--surface2); }
.rank-pos {
  font-family: var(--font-mono);
  font-size: 11px;
  width: 18px;
  text-align: center;
  color: var(--text3);
  font-weight: 700;
  flex-shrink: 0;
}
.rank-pos.p1 { color: var(--accent3); }
.rank-pos.p2 { color: #94a3b8; }
.rank-pos.p3 { color: #b45309; }
.rank-row-img {
  width: 26px; height: 26px;
  border-radius: 50%;
  object-fit: cover;
  background: var(--surface2);
  flex-shrink: 0;
}
.rank-row-name {
  font-size: 12px;
  font-weight: 600;
  color: var(--text);
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.rank-row-val {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--accent);
  font-weight: 700;
  flex-shrink: 0;
}
.rank-see-more {
  padding: 8px;
  text-align: center;
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 1px;
  color: var(--text3);
  cursor: pointer;
  border-top: 1px solid var(--border);
  transition: all 0.15s;
  text-transform: uppercase;
}
.rank-see-more:hover { color: var(--accent); background: rgba(0,229,255,0.04); }

/* ==============================
   TEAM / PITCH TAB
============================== */
.pitch-outer {
  max-width: 680px;
  margin: 0 auto;
  position: relative;
}
.pitch-label {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text3);
  letter-spacing: 2px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.football-pitch {
  background: linear-gradient(180deg, #0d4a1e 0%, #0f5c25 25%, #0d4a1e 50%, #0f5c25 75%, #0d4a1e 100%);
  border-radius: 16px;
  border: 2px solid rgba(255,255,255,0.12);
  position: relative;
  overflow: hidden;
  width: 100%;
  aspect-ratio: 3/4;
  box-shadow: 0 8px 32px rgba(0,0,0,0.6), inset 0 0 40px rgba(0,0,0,0.3);
}
.pitch-lines {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.pitch-player {
  position: absolute;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  z-index: 10;
  transition: transform 0.2s;
}
.pitch-player:hover { transform: translate(-50%, -50%) scale(1.12); }
.pitch-player-img-wrap { position: relative; }
.pitch-player-img {
  width: 44px; height: 44px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid rgba(255,255,255,0.6);
  background: #111;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}
.pitch-player-rating {
  position: absolute;
  bottom: -4px; right: -4px;
  background: #000;
  color: var(--accent3);
  font-family: var(--font-mono);
  font-size: 8px;
  font-weight: 700;
  padding: 1px 4px;
  border-radius: 4px;
  border: 1px solid rgba(245,158,11,0.4);
}
.pitch-player-name {
  margin-top: 5px;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(4px);
  color: #fff;
  font-size: 9px;
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 4px;
  letter-spacing: 0.5px;
  white-space: nowrap;
  max-width: 70px;
  overflow: hidden;
  text-overflow: ellipsis;
  border: 1px solid rgba(255,255,255,0.1);
}

/* ==============================
   FIFA CARD
============================== */
.fut-card {
  width: 240px;
  height: 360px;
  border-radius: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.7);
  flex-shrink: 0;
}
.fut-card.gold { background: linear-gradient(135deg, #3d2200 0%, #c87500 50%, #f5c542 100%); }
.fut-card.silver { background: linear-gradient(135deg, #151820 0%, #4a5568 50%, #a0aec0 100%); }
.fut-card.special { background: linear-gradient(135deg, #0a0e1a 0%, #1a237e 40%, #3949ab 70%, #5c6bc0 100%); }
.fut-card-shine {
  position: absolute; inset: 0;
  background: linear-gradient(125deg, transparent 30%, rgba(255,255,255,0.15) 45%, transparent 60%);
  pointer-events: none;
  z-index: 2;
}
.fut-card-ovr {
  position: absolute;
  top: 18px; left: 18px;
  z-index: 5;
  color: rgba(255,255,255,0.9);
  text-shadow: 0 2px 4px rgba(0,0,0,0.8);
}
.fut-card-ovr-num {
  font-family: var(--font-display);
  font-size: 52px;
  line-height: 1;
  letter-spacing: -1px;
}
.fut-card-ovr-pos {
  font-family: var(--font-display);
  font-size: 18px;
  letter-spacing: 2px;
  opacity: 0.85;
}
.fut-card-photo-wrap {
  position: absolute;
  top: 80px; left: 50%;
  transform: translateX(-50%);
  width: 130px; height: 130px;
  border-radius: 50%;
  border: 3px solid rgba(0,0,0,0.3);
  overflow: hidden;
  z-index: 5;
  background: rgba(0,0,0,0.3);
}
.fut-card-photo { width: 100%; height: 100%; object-fit: cover; }
.fut-card-name {
  position: absolute;
  top: 218px; width: 100%;
  text-align: center;
  font-family: var(--font-display);
  font-size: 24px;
  letter-spacing: 2px;
  color: rgba(255,255,255,0.95);
  text-shadow: 0 2px 6px rgba(0,0,0,0.8);
  z-index: 5;
  padding: 0 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.fut-card-divider {
  position: absolute;
  top: 248px; left: 30px; right: 30px;
  height: 1px;
  background: rgba(255,255,255,0.25);
  z-index: 5;
}
.fut-card-stats {
  position: absolute;
  bottom: 20px; left: 0; right: 0;
  padding: 0 20px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px 16px;
  z-index: 5;
}
.fut-stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255,255,255,0.15);
  padding-bottom: 4px;
}
.fut-stat-val {
  font-family: var(--font-display);
  font-size: 17px;
  color: rgba(255,255,255,0.95);
}
.fut-stat-label {
  font-size: 11px;
  opacity: 0.75;
  color: rgba(255,255,255,0.8);
  letter-spacing: 1px;
}

/* ==============================
   PLAYER MODAL — FIXED FOR MOBILE
============================== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(12px);
  z-index: 1000;
  display: none;
  align-items: flex-start;
  justify-content: center;
  padding: 20px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.modal-overlay.open { display: flex; }

.modal-close-btn {
  position: absolute;
  top: 16px; right: 16px;
  width: 36px; height: 36px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  color: var(--text2);
  font-size: 18px;
  transition: all 0.2s;
  z-index: 200;
  line-height: 1;
}
.modal-close-btn:hover { background: var(--surface3); color: var(--text); }

/* Player Modal Content */
#player-modal-inner {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  width: 100%;
  max-width: 880px;
  display: flex;
  gap: 32px;
  padding: 32px;
  align-items: flex-start;
  position: relative;
  flex-wrap: wrap;
  animation: modalIn 0.25s ease;
  margin: auto;
}
@keyframes modalIn {
  from { opacity: 0; transform: scale(0.95) translateY(10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.player-detail-right { flex: 1; min-width: 260px; }
.player-detail-name {
  font-family: var(--font-display);
  font-size: 42px;
  letter-spacing: 3px;
  margin-bottom: 4px;
  line-height: 1;
}
.player-detail-level {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--accent);
  border: 1px solid rgba(0,229,255,0.3);
  background: rgba(0,229,255,0.08);
  padding: 3px 10px;
  border-radius: 999px;
  letter-spacing: 2px;
  margin-bottom: 20px;
}
.player-stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}
.player-stat-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  padding: 10px;
  text-align: center;
}
.player-stat-box-label {
  font-family: var(--font-mono);
  font-size: 8px;
  color: var(--text3);
  letter-spacing: 2px;
  display: block;
  margin-bottom: 4px;
}
.player-stat-box-val {
  font-family: var(--font-display);
  font-size: 26px;
  letter-spacing: 1px;
  line-height: 1;
}

.player-chart-wrap {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  padding: 12px;
  margin-bottom: 16px;
  height: 140px;
  position: relative;
}
.player-chart-title {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 2px;
  margin-bottom: 8px;
}

.player-history-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  margin-bottom: 4px;
  font-size: 11px;
}
.history-date { font-family: var(--font-mono); color: var(--text3); }
.history-badges { display: flex; gap: 4px; }
.badge {
  font-family: var(--font-mono);
  font-size: 9px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 4px;
}
.badge-g { background: rgba(34,197,94,0.15); color: var(--green); border: 1px solid rgba(34,197,94,0.2); }
.badge-a { background: rgba(59,130,246,0.15); color: #60a5fa; border: 1px solid rgba(59,130,246,0.2); }
.badge-gc { background: rgba(239,68,68,0.15); color: var(--red); border: 1px solid rgba(239,68,68,0.2); }
.history-nota {
  font-family: var(--font-mono);
  font-size: 13px;
  font-weight: 700;
}
.nota-high { color: var(--accent3); }
.nota-mid { color: var(--text); }
.nota-low { color: var(--text3); }

.print-btn-modal {
  position: absolute;
  top: 16px; right: 56px;
  width: 36px; height: 36px;
  background: rgba(0,229,255,0.1);
  border: 1px solid rgba(0,229,255,0.2);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  color: var(--accent);
  font-size: 13px;
  transition: all 0.2s;
  z-index: 200;
}
.print-btn-modal:hover { background: rgba(0,229,255,0.2); }

/* ==============================
   MATCH MODAL
============================== */
#match-modal-inner {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  width: 100%;
  max-width: 1200px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
  animation: modalIn 0.25s ease;
  margin: auto;
}
.match-modal-header {
  padding: 16px 24px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.match-date-label {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 3px;
  text-align: center;
  margin-bottom: 8px;
}
.match-score-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
}
.match-team-name {
  font-family: var(--font-display);
  font-size: 40px;
  letter-spacing: 4px;
}
.match-team-name.boca { color: var(--boca); }
.match-team-name.river { color: var(--river); }
.match-score-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 4px 24px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.match-score-num {
  font-family: var(--font-display);
  font-size: 52px;
  letter-spacing: 2px;
  color: var(--text);
  line-height: 1;
}
.match-score-sep {
  font-family: var(--font-display);
  font-size: 24px;
  color: var(--text3);
}
.match-modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: grid;
  grid-template-columns: 1fr 1.5fr 1fr;
  gap: 16px;
}
.match-list-header {
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text3);
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.match-player-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: var(--r2);
  cursor: pointer;
  transition: background 0.15s;
  border: 1px solid transparent;
}
.match-player-row:hover { background: var(--surface2); border-color: var(--border); }
.match-player-pos {
  font-family: var(--font-mono);
  font-size: 8px;
  font-weight: 700;
  padding: 1px 5px;
  border-radius: 4px;
  flex-shrink: 0;
}
.pos-ata { background: rgba(59,130,246,0.15); color: #60a5fa; border: 1px solid rgba(59,130,246,0.2); }
.pos-mei { background: rgba(34,197,94,0.12); color: var(--green); border: 1px solid rgba(34,197,94,0.2); }
.pos-ala { background: rgba(168,85,247,0.15); color: #c084fc; border: 1px solid rgba(168,85,247,0.2); }
.pos-def, .pos-zag { background: rgba(245,158,11,0.12); color: var(--accent3); border: 1px solid rgba(245,158,11,0.2); }
.pos-gol { background: rgba(248,113,113,0.12); color: #f87171; border: 1px solid rgba(248,113,113,0.2); }
.match-player-name {
  flex: 1;
  font-size: 12px;
  font-weight: 600;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.match-player-nota {
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 700;
  flex-shrink: 0;
}
.match-player-badges { display: flex; gap: 3px; }

/* ==============================
   STATS TAB
============================== */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}
.chart-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 16px;
  height: 280px;
  position: relative;
}
.chart-panel.wide { grid-column: span 3; }
.chart-title {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 12px;
}

/* ==============================
   HISTORY TAB
============================== */
.history-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 14px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  transition: all 0.15s;
  margin-bottom: 8px;
}
.history-item:hover { border-color: var(--border2); background: var(--surface2); }
.history-item-date {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text3);
}
.history-score {
  font-family: var(--font-display);
  font-size: 22px;
  letter-spacing: 2px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.history-score .boca { color: var(--boca); }
.history-score .river { color: var(--river); }
.history-score .sep { color: var(--text3); font-size: 14px; }
.history-badge {
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 1px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid var(--border);
  color: var(--text3);
}
.history-badge.pending { color: var(--accent3); border-color: rgba(245,158,11,0.3); background: rgba(245,158,11,0.05); }

/* ==============================
   HALL TAB
============================== */
.hall-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 14px;
}
.hall-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 20px 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.hall-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--accent3), transparent);
  opacity: 0;
  transition: opacity 0.2s;
}
.hall-card:hover { transform: translateY(-3px); border-color: var(--border2); }
.hall-card:hover::before { opacity: 1; }
.hall-card-img {
  width: 64px; height: 64px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--border2);
  margin-bottom: 12px;
  background: var(--surface2);
}
.hall-card-name {
  font-family: var(--font-display);
  font-size: 18px;
  letter-spacing: 1px;
  color: var(--text);
  margin-bottom: 4px;
}
.hall-trophy-count {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--accent3);
  margin-bottom: 10px;
}
.hall-conquistas { display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; }
.conquista-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
}
.conquista-lendario { background: var(--accent3); box-shadow: 0 0 6px var(--accent3); }
.conquista-epico { background: #c084fc; }
.conquista-raro { background: var(--boca); }
.conquista-mitico { background: var(--accent); box-shadow: 0 0 6px var(--accent); }

/* ==============================
   DRAFT TAB
============================== */
.draft-layout {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 20px;
  align-items: start;
}
.draft-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  position: sticky;
  top: 0;
}
.draft-player-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 7px 12px;
  cursor: pointer;
  transition: background 0.12s;
  border-bottom: 1px solid var(--border);
}
.draft-player-row:hover { background: var(--surface2); }
.draft-player-row.selected { background: rgba(0,229,255,0.06); }
.draft-checkbox {
  width: 14px; height: 14px;
  border: 1px solid var(--border2);
  border-radius: 3px;
  display: flex; align-items: center; justify-content: center;
  font-size: 9px;
  color: transparent;
  transition: all 0.12s;
  flex-shrink: 0;
}
.draft-checkbox.checked { background: var(--accent); border-color: var(--accent); color: #000; }
.draft-player-row-name { flex: 1; font-size: 12px; font-weight: 600; color: var(--text2); }
.draft-player-row-pos {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 1px;
}
.draft-player-row-ovr {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent3);
  font-weight: 700;
}

.team-result-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
}
.team-result-header {
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}
.team-result-name {
  font-family: var(--font-display);
  font-size: 22px;
  letter-spacing: 2px;
}
.team-result-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  border-bottom: 1px solid var(--border);
  font-size: 13px;
  color: var(--text2);
}
.team-result-row:last-child { border-bottom: none; }

.verdict-box {
  background: rgba(124,58,237,0.08);
  border: 1px solid rgba(124,58,237,0.2);
  border-radius: var(--r);
  padding: 16px;
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}
.verdict-icon { font-size: 18px; color: var(--accent2); flex-shrink: 0; }
.verdict-text { font-size: 13px; color: var(--text2); line-height: 1.5; }

/* ==============================
   COMPARISON MODAL
============================== */
#comparison-modal-inner {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  width: 100%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 32px;
  position: relative;
  animation: modalIn 0.25s ease;
  margin: auto;
}
.compare-selects {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 32px;
}
.compare-select-wrap { flex: 1; }
.compare-select-label { font-family: var(--font-mono); font-size: 9px; letter-spacing: 2px; color: var(--text3); margin-bottom: 6px; }
.compare-select {
  width: 100%;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--r2);
  padding: 8px 12px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 13px;
  outline: none;
}
.vs-label {
  font-family: var(--font-display);
  font-size: 32px;
  color: var(--text3);
  letter-spacing: 4px;
  flex-shrink: 0;
}
.compare-stat-row {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
}
.compare-val {
  font-family: var(--font-mono);
  font-size: 18px;
  font-weight: 700;
  text-align: center;
}
.compare-val.winner { color: var(--green); }
.compare-val.loser { color: var(--text3); }
.compare-label { font-family: var(--font-mono); font-size: 9px; color: var(--text3); letter-spacing: 2px; text-align: center; }

/* ==============================
   FULL LIST MODAL
============================== */
#full-list-modal-inner {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: 100%;
  max-width: 520px;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  position: relative;
  animation: modalIn 0.2s ease;
  margin: auto;
}
.full-list-table { flex: 1; overflow-y: auto; }
.full-list-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.12s;
}
.full-list-row:hover { background: var(--surface2); }

/* ==============================
   QUICK STATS (NEW FEATURE)
============================== */
.quick-stats-bar {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  overflow-x: auto;
  padding-bottom: 4px;
}
.qs-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 12px 16px;
  flex-shrink: 0;
  min-width: 120px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.qs-item:hover { border-color: var(--border2); }
.qs-item-label {
  font-family: var(--font-mono);
  font-size: 8px;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 6px;
}
.qs-item-val {
  font-family: var(--font-display);
  font-size: 28px;
  color: var(--text);
  letter-spacing: 1px;
  line-height: 1;
}
.qs-item-sub {
  font-size: 10px;
  color: var(--text3);
  margin-top: 2px;
}
.qs-accent {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 2px;
}

/* ==============================
   FUN FACTS
============================== */
.funfacts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 12px;
  margin-top: 24px;
}
.funfact-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 14px 16px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  transition: border-color 0.2s;
}
.funfact-item:hover { border-color: var(--border2); }
.funfact-icon {
  width: 36px; height: 36px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
}
.funfact-title {
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 1px;
  color: var(--text3);
  text-transform: uppercase;
  margin-bottom: 4px;
}
.funfact-text { font-size: 12px; color: var(--text2); line-height: 1.5; }
.funfact-text strong { color: var(--text); font-weight: 700; }

/* ==============================
   SECTION TITLES
============================== */
.section-title {
  font-family: var(--font-display);
  font-size: 18px;
  letter-spacing: 2px;
  color: var(--text);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.section-title i { color: var(--accent); font-size: 14px; }
.section-title-line {
  flex: 1;
  height: 1px;
  background: var(--border);
  margin-left: 8px;
}

/* ==============================
   LOADING
============================== */
#loading {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.loading-spinner {
  width: 48px; height: 48px;
  border: 3px solid var(--surface3);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: 20px;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text {
  font-family: var(--font-display);
  font-size: 24px;
  letter-spacing: 6px;
  color: var(--text);
  animation: pulse 1.5s ease-in-out infinite;
}
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
.loading-sub {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text3);
  letter-spacing: 4px;
  margin-top: 6px;
}

/* ==============================
   MOBILE MENU
============================== */
#mobile-menu-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 500;
  flex-direction: column;
  padding: 24px;
}
#mobile-menu-overlay.open { display: flex; }
.mobile-nav-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 10px;
  font-size: 16px;
  font-weight: 700;
  color: var(--text2);
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: color 0.15s;
}
.mobile-nav-item:hover, .mobile-nav-item.active { color: var(--text); }
.mobile-nav-item i { width: 20px; text-align: center; color: var(--accent); }

/* ==============================
   PRINT MODE (Instagram Stories)
============================== */

/* Botão câmera fica verde quando ativo */
#player-modal.print-active .print-btn-modal {
  background: rgba(34,197,94,0.2);
  border-color: rgba(34,197,94,0.3);
  color: var(--green);
}

/* O overlay some completamente — só o card na tela */
#player-modal.print-active {
  background: transparent !important;
  backdrop-filter: none !important;
  padding: 0 !important;
  overflow: hidden !important;
  align-items: stretch !important;
  justify-content: stretch !important;
}

/* O inner vira um card stories fullscreen */
#player-modal.print-active #player-modal-inner {
  width: 100% !important;
  max-width: 100% !important;
  height: 100% !important;
  min-height: 100% !important;
  border-radius: 0 !important;
  border: none !important;
  margin: 0 !important;
  padding: 0 !important;
  gap: 0 !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  text-align: center !important;
  position: relative !important;
  overflow: hidden !important;
  background:
    radial-gradient(ellipse at 20% 20%, rgba(124,58,237,0.25) 0%, transparent 55%),
    radial-gradient(ellipse at 80% 80%, rgba(0,229,255,0.15) 0%, transparent 55%),
    linear-gradient(160deg, #080c10 0%, #0d1117 50%, #080c10 100%) !important;
}

/* Fundo decorativo animado no modo stories */
#player-modal.print-active #player-modal-inner::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    repeating-linear-gradient(
      0deg,
      transparent,
      transparent 60px,
      rgba(255,255,255,0.015) 60px,
      rgba(255,255,255,0.015) 61px
    ),
    repeating-linear-gradient(
      90deg,
      transparent,
      transparent 60px,
      rgba(255,255,255,0.015) 60px,
      rgba(255,255,255,0.015) 61px
    );
  pointer-events: none;
  z-index: 0;
}

/* Esconde tudo que não é necessário no stories */
#player-modal.print-active .modal-close-btn,
#player-modal.print-active .print-btn-modal {
  position: fixed !important;
  z-index: 2000 !important;
  top: 16px !important;
}
#player-modal.print-active .modal-close-btn { right: 16px !important; }
#player-modal.print-active .print-btn-modal { right: 60px !important; }

#player-modal.print-active .player-chart-wrap,
#player-modal.print-active #player-history-section,
#player-modal.print-active #detail-badges {
  display: none !important;
}

/* Espaço entre card e info no stories */
#player-modal.print-active #modal-card-container {
  position: relative;
  z-index: 1;
  width: 220px !important;
  height: 330px !important;
  margin-bottom: 20px !important;
  flex-shrink: 0 !important;
  box-shadow: 0 32px 80px rgba(0,0,0,0.8), 0 0 40px rgba(124,58,237,0.2) !important;
}

/* Área de info do jogador no stories */
#player-modal.print-active .player-detail-right {
  width: 100% !important;
  min-width: unset !important;
  flex: unset !important;
  padding: 0 28px !important;
  position: relative;
  z-index: 1;
}

/* Nome grande e centralizado */
#player-modal.print-active .player-detail-name {
  font-size: 36px !important;
  letter-spacing: 4px !important;
  text-align: center !important;
  margin-bottom: 6px !important;
  color: var(--text) !important;
  text-shadow: 0 2px 12px rgba(0,0,0,0.8) !important;
}

/* Badge de nível centralizado */
#player-modal.print-active .player-detail-level {
  display: block !important;
  text-align: center !important;
  margin-bottom: 16px !important;
}

/* Grid de stats 2x2 */
#player-modal.print-active .player-stats-grid {
  grid-template-columns: 1fr 1fr !important;
  gap: 8px !important;
  margin-bottom: 0 !important;
}

#player-modal.print-active .player-stat-box {
  background: rgba(255,255,255,0.06) !important;
  border-color: rgba(255,255,255,0.1) !important;
}

/* Tag do clube / watermark no canto */
#player-modal.print-active #player-modal-inner::after {
  content: '⚽ INIMIGOS DA BOLA · 2026';
  position: absolute;
  bottom: 20px;
  left: 0; right: 0;
  text-align: center;
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 3px;
  color: rgba(255,255,255,0.2);
  z-index: 1;
}

/* Instrução de print visível no modo stories */
#print-hint {
  display: none;
}
#player-modal.print-active #print-hint {
  display: block;
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,229,255,0.12);
  border: 1px solid rgba(0,229,255,0.25);
  border-radius: 999px;
  padding: 8px 20px;
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--accent);
  letter-spacing: 2px;
  white-space: nowrap;
  z-index: 2000;
  animation: pulseHint 2s ease-in-out infinite;
}
@keyframes pulseHint {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* ==============================
   RESPONSIVE MOBILE — FIXED
============================== */
@media (max-width: 768px) {
  #topbar { padding: 0 16px; }
  #topbar .topbar-filter, #topbar .topbar-search-wrap { display: none; }
  #mobile-menu-btn { display: flex; }
  #sidebar { display: none; }
  #main { padding: 16px; }
  
  .hub-grid { grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
  .stat-card { padding: 12px; }
  .stat-card-name { font-size: 14px; }
  .stat-card-img { width: 32px; height: 32px; }
  #hero-img { width: 60px; height: 60px; }
  #hero-name { font-size: 28px; }
  #hero-rating { font-size: 34px; }
  
  #rankings-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
  
  .stats-grid { grid-template-columns: 1fr; }
  .chart-panel.wide { grid-column: span 1; }
  
  .draft-layout { grid-template-columns: 1fr; }
  .draft-panel { position: static; }
  
  .match-modal-body { grid-template-columns: 1fr; }
  .match-team-name { font-size: 26px; }
  .match-score-num { font-size: 36px; }

  /* ---- KEY MOBILE MODAL FIX ---- */
  .modal-overlay {
    padding: 12px;
    align-items: flex-start;
  }

  #player-modal-inner {
    flex-direction: column;
    align-items: center;
    padding: 56px 16px 20px;
    gap: 20px;
    margin: 0 auto;
    border-radius: 16px;
  }

  /* Make close button and print button always on top and visible */
  #player-modal-inner .modal-close-btn,
  #player-modal-inner .print-btn-modal {
    position: fixed;
    top: 20px;
    z-index: 1100;
  }
  #player-modal-inner .modal-close-btn {
    right: 20px;
  }
  #player-modal-inner .print-btn-modal {
    right: 64px;
  }

  .fut-card {
    width: 200px;
    height: 300px;
  }
  .fut-card-ovr-num { font-size: 42px; }
  .fut-card-photo-wrap { width: 100px; height: 100px; top: 60px; }
  .fut-card-name { top: 174px; font-size: 20px; }
  .fut-card-divider { top: 200px; }
  .fut-card-stats { bottom: 14px; }

  .player-detail-name { font-size: 30px; text-align: center; }
  .player-stats-grid { grid-template-columns: repeat(2, 1fr); }
  
  .compare-selects { flex-wrap: wrap; }
  .vs-label { width: 100%; text-align: center; }
  
  .quick-stats-bar { gap: 8px; }
  .qs-item { padding: 10px 12px; min-width: 100px; }
  .qs-item-val { font-size: 22px; }
  
  .pitch-player-img { width: 34px; height: 34px; }
  .pitch-player-name { font-size: 8px; max-width: 56px; }

  .funfacts-grid { grid-template-columns: 1fr; }
  .hall-grid { grid-template-columns: repeat(2, 1fr); }

  #match-modal-inner {
    max-height: 95vh;
    border-radius: 16px;
  }

  #comparison-modal-inner {
    padding: 56px 16px 20px;
    border-radius: 16px;
  }
}

@media (max-width: 480px) {
  .hub-grid { grid-template-columns: 1fr; }
  #rankings-grid { grid-template-columns: 1fr; }
  .hall-grid { grid-template-columns: 1fr 1fr; }
  .player-stats-grid { grid-template-columns: repeat(2, 1fr); }
  .match-score-box { padding: 4px 12px; }
}

/* Transitions */
button, .btn-icon, .nav-item, .rank-row, .history-item, .hall-card, .stat-card, .funfact-item { -webkit-tap-highlight-color: transparent; }

/* ==============================
   PITCH SVG LINES
============================== */
.pitch-svg { position: absolute; inset: 0; width: 100%; height: 100%; }
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading">
  <div class="loading-spinner"></div>
  <div class="loading-text">INIMIGOS</div>
  <div class="loading-sub">DA BOLA 2026</div>
</div>

<!-- TOPBAR -->
<div id="topbar">
  <div class="topbar-logo">
    <div class="topbar-logo-icon"><i class="fas fa-futbol"></i></div>
    <div>
      <h1>INIMIGOS</h1>
      <span>DA BOLA · 2026</span>
    </div>
  </div>
  <div class="topbar-right">
    <div class="topbar-search-wrap">
      <i class="fas fa-search"></i>
      <input type="text" id="player-search" placeholder="Buscar jogador...">
    </div>
    <div style="position:relative">
      <select id="month-filter" class="topbar-filter">
        <option value="2026-ALL">Temporada 2026 (Atual)</option>
      </select>
    </div>
    <div class="btn-icon" id="btn-compare" title="Comparar jogadores"><i class="fas fa-balance-scale"></i></div>
    <div class="btn-icon" id="btn-update" title="Atualizar dados"><i class="fas fa-sync-alt"></i></div>
    <div class="btn-icon" id="mobile-menu-btn"><i class="fas fa-bars"></i></div>
  </div>
</div>

<!-- LAYOUT -->
<div id="layout">
  <!-- SIDEBAR -->
  <div id="sidebar">
    <div class="nav-section-label">Principal</div>
    <div class="nav-item active" data-tab="hub"><i class="fas fa-th-large"></i> Hub & Rankings</div>
    <div class="nav-item" data-tab="team"><i class="fas fa-tshirt"></i> Seleção</div>
    <div class="nav-item" data-tab="draft"><i class="fas fa-users"></i> Snake Draft</div>
    <div class="nav-item" data-tab="stats"><i class="fas fa-chart-pie"></i> Estatísticas</div>
    <div class="nav-item" data-tab="history"><i class="fas fa-history"></i> Histórico</div>
    <div class="nav-item" data-tab="hall"><i class="fas fa-trophy"></i> Hall da Fama</div>
    <div class="nav-section-label">Ferramentas</div>
    <div class="nav-item tool" id="btn-compare-side"><i class="fas fa-balance-scale"></i> Comparar</div>
    <div class="nav-item tool" id="btn-update-side"><i class="fas fa-sync-alt"></i> Atualizar</div>
  </div>

  <!-- MAIN -->
  <div id="main">

    <!-- HUB TAB -->
    <div id="hub" class="tab-content active">
      <div id="hero-section">
        <div class="hero-inner">
          <div class="hero-photo-wrap">
            <img id="hero-img" src="" onerror="this.src='https://ui-avatars.com/api/?name=MVP&size=80'">
            <div class="hero-mvp-tag">MVP</div>
          </div>
          <div class="hero-info">
            <div class="hero-label" id="hero-label">MELHOR DA TEMPORADA</div>
            <div id="hero-name">NOME</div>
            <div class="hero-stats">
              <div class="hero-stat"><i class="fas fa-futbol"></i><span id="hero-goals">0</span> gols</div>
              <div class="hero-stat"><i class="fas fa-shoe-prints"></i><span id="hero-assists">0</span> assist</div>
              <div class="hero-stat"><i class="fas fa-star"></i><span id="hero-games">0</span> jogos</div>
            </div>
          </div>
          <div class="hero-rating-box">
            <span class="hero-rating-label">MÉDIA</span>
            <span id="hero-rating">0.0</span>
          </div>
        </div>
      </div>

      <!-- Quick stats -->
      <div class="quick-stats-bar" id="quick-stats"></div>

      <!-- Spotlight cards (garcom, paredao, artilheiro) -->
      <div class="hub-grid" id="hub-spotlights"></div>

      <div class="section-title"><i class="fas fa-list-ol"></i> RANKINGS <div class="section-title-line"></div></div>
      <div id="rankings-grid"></div>
    </div>

    <!-- TEAM TAB -->
    <div id="team" class="tab-content">
      <div class="section-title" style="margin-bottom:12px">
        <i class="fas fa-tshirt"></i> SELEÇÃO
        <span id="team-period-label" style="font-family:var(--font-mono);font-size:11px;color:var(--text3);margin-left:8px;font-family:var(--font-mono)"></span>
        <div class="section-title-line"></div>
      </div>
      <div class="pitch-outer">
        <div class="football-pitch" id="main-pitch">
          <svg class="pitch-svg" viewBox="0 0 300 400" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0" y="0" width="300" height="400" fill="none"/>
            <!-- Outer border -->
            <rect x="10" y="10" width="280" height="380" rx="2" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <!-- Halfway line -->
            <line x1="10" y1="200" x2="290" y2="200" stroke="rgba(255,255,255,0.18)" stroke-width="1.5"/>
            <!-- Center circle -->
            <circle cx="150" cy="200" r="36" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <circle cx="150" cy="200" r="3" fill="rgba(255,255,255,0.25)"/>
            <!-- Top penalty area -->
            <rect x="75" y="10" width="150" height="56" rx="0" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <!-- Top goal area (small box) -->
            <rect x="113" y="10" width="74" height="24" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <!-- Top goal -->
            <rect x="125" y="6" width="50" height="10" rx="2" stroke="rgba(255,255,255,0.25)" stroke-width="1" fill="rgba(255,255,255,0.04)"/>
            <!-- Bottom penalty area -->
            <rect x="75" y="334" width="150" height="56" rx="0" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <!-- Bottom goal area -->
            <rect x="113" y="366" width="74" height="24" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <!-- Bottom goal -->
            <rect x="125" y="384" width="50" height="10" rx="2" stroke="rgba(255,255,255,0.25)" stroke-width="1" fill="rgba(255,255,255,0.04)"/>
            <!-- Penalty spots -->
            <circle cx="150" cy="54" r="2" fill="rgba(255,255,255,0.25)"/>
            <circle cx="150" cy="346" r="2" fill="rgba(255,255,255,0.25)"/>
            <!-- Corner arcs -->
            <path d="M10 20 A10 10 0 0 1 20 10" stroke="rgba(255,255,255,0.15)" stroke-width="1" fill="none"/>
            <path d="M280 10 A10 10 0 0 1 290 20" stroke="rgba(255,255,255,0.15)" stroke-width="1" fill="none"/>
            <path d="M10 380 A10 10 0 0 0 20 390" stroke="rgba(255,255,255,0.15)" stroke-width="1" fill="none"/>
            <path d="M280 390 A10 10 0 0 0 290 380" stroke="rgba(255,255,255,0.15)" stroke-width="1" fill="none"/>
          </svg>
          <div id="pitch-players" style="position:absolute;inset:0;"></div>
        </div>
      </div>
    </div>

    <!-- DRAFT TAB -->
    <div id="draft" class="tab-content">
      <div class="section-title"><i class="fas fa-users"></i> SNAKE DRAFT <div class="section-title-line"></div></div>
      <div class="draft-layout">
        <div class="draft-panel">
          <div class="panel-header" style="background:var(--surface2)">
            <span class="panel-title">CONVOCAÇÃO</span>
            <span id="selected-count" style="font-family:var(--font-mono);font-size:10px;color:var(--accent);background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.15);padding:2px 8px;border-radius:999px;">0 JOG</span>
          </div>
          <div style="padding:10px 12px;display:flex;gap:8px;border-bottom:1px solid var(--border)">
            <button id="select-all" onclick="selectAll()" style="flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:6px;font-family:var(--font-mono);font-size:9px;color:var(--text2);cursor:pointer;letter-spacing:1px;transition:all 0.15s;" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--text2)'">TODOS</button>
            <button id="clear-all" onclick="clearAll()" style="flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:6px;font-family:var(--font-mono);font-size:9px;color:var(--text2);cursor:pointer;letter-spacing:1px;transition:all 0.15s;" onmouseover="this.style.color='var(--red)'" onmouseout="this.style.color='var(--text2)'">LIMPAR</button>
          </div>
          <div id="draft-list" style="max-height:420px;overflow-y:auto;"></div>
          <div style="padding:12px">
            <button id="generate-teams" onclick="generateTeams()" style="width:100%;background:linear-gradient(135deg,var(--accent2),var(--accent));border:none;border-radius:8px;padding:12px;color:#fff;font-family:var(--font-display);font-size:16px;letter-spacing:2px;cursor:pointer;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-random" style="margin-right:8px"></i>GERAR TIMES</button>
          </div>
        </div>

        <div id="draft-result-area">
          <div id="verdict-panel" style="display:none;margin-bottom:16px;" class="verdict-box">
            <div class="verdict-icon"><i class="fas fa-robot"></i></div>
            <div class="verdict-text" id="verdict-text"></div>
          </div>
          <div id="teams-container" style="display:none;grid-template-columns:1fr 1fr;gap:16px">
            <div class="team-result-panel">
              <div class="team-result-header">
                <div class="team-result-name" style="color:var(--boca)">TIME A</div>
                <span id="stats-team-a" style="font-family:var(--font-mono);font-size:10px;color:var(--text3);"></span>
              </div>
              <div id="list-team-a"></div>
            </div>
            <div class="team-result-panel">
              <div class="team-result-header">
                <div class="team-result-name" style="color:var(--river)">TIME B</div>
                <span id="stats-team-b" style="font-family:var(--font-mono);font-size:10px;color:var(--text3);"></span>
              </div>
              <div id="list-team-b"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- STATS TAB -->
    <div id="stats" class="tab-content">
      <div class="section-title"><i class="fas fa-chart-pie"></i> ESTATÍSTICAS <div class="section-title-line"></div></div>
      <div class="stats-grid">
        <div class="chart-panel"><div class="chart-title">TOP ARTILHEIROS</div><canvas id="chart-gols" style="height:220px"></canvas></div>
        <div class="chart-panel"><div class="chart-title">TOP ASSISTÊNCIAS</div><canvas id="chart-assists" style="height:220px"></canvas></div>
        <div class="chart-panel"><div class="chart-title">MAIS JOGOS</div><canvas id="chart-games" style="height:220px"></canvas></div>
        <div class="chart-panel wide"><div class="chart-title">EVOLUÇÃO DE GOLS MENSAIS</div><canvas id="chart-group-goals" style="height:200px"></canvas></div>
      </div>
      <div class="section-title"><i class="fas fa-lightbulb"></i> CURIOSIDADES <div class="section-title-line"></div></div>
      <div id="curiosities-grid" class="funfacts-grid"></div>
    </div>

    <!-- HISTORY TAB -->
    <div id="history" class="tab-content">
      <div class="section-title"><i class="fas fa-history"></i> HISTÓRICO DE PARTIDAS <div class="section-title-line"></div></div>
      <div id="matches-list"></div>
    </div>

    <!-- HALL TAB -->
    <div id="hall" class="tab-content">
      <div class="section-title"><i class="fas fa-trophy"></i> HALL DA FAMA <div class="section-title-line"></div></div>
      <div id="hall-grid" class="hall-grid"></div>
    </div>

  </div><!-- /main -->
</div><!-- /layout -->

<!-- MOBILE MENU -->
<div id="mobile-menu-overlay">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
    <div style="font-family:var(--font-display);font-size:26px;letter-spacing:3px;color:var(--text)">MENU</div>
    <div id="close-mobile-menu" style="font-size:28px;color:var(--text3);cursor:pointer;line-height:1;">&times;</div>
  </div>
  <div style="margin-bottom:12px;">
    <select id="month-filter-mobile" class="topbar-filter" style="width:100%;">
      <option value="2026-ALL">Temporada 2026 (Atual)</option>
    </select>
  </div>
  <div style="margin-bottom:16px;">
    <div class="topbar-search-wrap" style="width:100%">
      <i class="fas fa-search" style="left:12px"></i>
      <input type="text" id="player-search-mobile" placeholder="Buscar jogador..." style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:9px 12px 9px 32px;color:var(--text);font-family:var(--font-body);font-size:14px;outline:none;">
    </div>
  </div>
  <div class="mobile-nav-item active" data-tab="hub"><i class="fas fa-th-large"></i> Hub & Rankings</div>
  <div class="mobile-nav-item" data-tab="team"><i class="fas fa-tshirt"></i> Seleção</div>
  <div class="mobile-nav-item" data-tab="draft"><i class="fas fa-users"></i> Snake Draft</div>
  <div class="mobile-nav-item" data-tab="stats"><i class="fas fa-chart-pie"></i> Estatísticas</div>
  <div class="mobile-nav-item" data-tab="history"><i class="fas fa-history"></i> Histórico</div>
  <div class="mobile-nav-item" data-tab="hall"><i class="fas fa-trophy"></i> Hall da Fama</div>
  <div class="mobile-nav-item" id="mob-compare"><i class="fas fa-balance-scale"></i> Comparar</div>
  <div class="mobile-nav-item" id="mob-update"><i class="fas fa-sync-alt"></i> Atualizar</div>
</div>

<!-- PLAYER MODAL -->
<div id="player-modal" class="modal-overlay">
  <div id="print-hint">📸 TIRE O PRINT AGORA</div>
  <div id="player-modal-inner">
    <div class="print-btn-modal" id="print-player-btn" title="Modo Stories"><i class="fas fa-camera"></i></div>
    <div class="modal-close-btn" id="close-player-modal">&times;</div>

    <div class="fut-card silver" id="modal-card-container">
      <div class="fut-card-shine"></div>
      <div class="fut-card-ovr"><div class="fut-card-ovr-num" id="card-ovr">60</div><div class="fut-card-ovr-pos" id="card-pos">ATA</div></div>
      <div class="fut-card-photo-wrap"><img id="card-img" src="" class="fut-card-photo" onerror="this.src='https://ui-avatars.com/api/?name=P&size=130'"></div>
      <div class="fut-card-name" id="card-name">NOME</div>
      <div class="fut-card-divider"></div>
      <div class="fut-card-stats">
        <div class="fut-stat-item"><span class="fut-stat-val" id="stat-pac">00</span><span class="fut-stat-label">PAC</span></div>
        <div class="fut-stat-item"><span class="fut-stat-val" id="stat-sho">00</span><span class="fut-stat-label">SHO</span></div>
        <div class="fut-stat-item"><span class="fut-stat-val" id="stat-pas">00</span><span class="fut-stat-label">PAS</span></div>
        <div class="fut-stat-item"><span class="fut-stat-val" id="stat-def">00</span><span class="fut-stat-label">DEF</span></div>
        <div class="fut-stat-item"><span class="fut-stat-val" id="stat-phy">00</span><span class="fut-stat-label">PHY</span></div>
        <div class="fut-stat-item"><span class="fut-stat-val" id="stat-jog">00</span><span class="fut-stat-label" style="color:var(--accent3)">JOG</span></div>
      </div>
    </div>

    <div class="player-detail-right">
      <div class="player-detail-name" id="detail-name">Nome</div>
      <div class="player-detail-level" id="detail-level">Iniciante</div>
      <div class="player-stats-grid">
        <div class="player-stat-box">
          <span class="player-stat-box-label">MÉDIA</span>
          <span class="player-stat-box-val" id="detail-media" style="color:var(--accent)">0.0</span>
        </div>
        <div class="player-stat-box">
          <span class="player-stat-box-label">GOLS</span>
          <span class="player-stat-box-val" id="detail-gols" style="color:var(--green)">0</span>
        </div>
        <div class="player-stat-box">
          <span class="player-stat-box-label">ASSISTS</span>
          <span class="player-stat-box-val" id="detail-assist" style="color:var(--accent3)">0</span>
        </div>
        <div class="player-stat-box">
          <span class="player-stat-box-label">VITÓRIAS</span>
          <span class="player-stat-box-val" id="detail-wins" style="color:#c084fc">0</span>
        </div>
      </div>
      <div class="player-chart-wrap">
        <div class="player-chart-title">EVOLUÇÃO DE PERFORMANCE</div>
        <canvas id="player-evo-chart" style="height:100px"></canvas>
      </div>
      <div id="detail-badges" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:16px;"></div>
      <div id="player-history-section">
        <div style="font-family:var(--font-mono);font-size:9px;color:var(--text3);letter-spacing:2px;margin-bottom:8px;text-transform:uppercase;">Últimas Partidas</div>
        <div id="detail-history"></div>
      </div>
    </div>
  </div>
</div>

<!-- MATCH MODAL -->
<div id="match-modal" class="modal-overlay">
  <div id="match-modal-inner">
    <div class="modal-close-btn" id="close-match-modal">&times;</div>
    <div class="print-btn-modal" id="print-match-btn" style="top:16px;right:56px;" title="Modo Print"><i class="fas fa-camera"></i></div>
    <div class="match-modal-header">
      <div class="match-date-label" id="match-date">DATA</div>
      <div class="match-score-row">
        <div class="match-team-name boca">BOCA</div>
        <div class="match-score-box">
          <span class="match-score-num" id="score-a">0</span>
          <span class="match-score-sep">-</span>
          <span class="match-score-num" id="score-b">0</span>
        </div>
        <div class="match-team-name river">RIVER</div>
      </div>
    </div>
    <div class="match-modal-body">
      <div>
        <div class="match-list-header"><div style="width:6px;height:6px;border-radius:50%;background:var(--boca);box-shadow:0 0 6px var(--boca);"></div>ELENCO BOCA</div>
        <div id="list-boca"></div>
      </div>
      <div>
        <div class="match-list-header" style="justify-content:center"><i class="fas fa-star" style="color:var(--accent3)"></i> SELEÇÃO DO JOGO</div>
        <div class="football-pitch" id="match-pitch" style="height:100%;min-height:320px;aspect-ratio:unset;border-radius:12px;">
          <svg class="pitch-svg" viewBox="0 0 300 400" fill="none">
            <rect x="10" y="10" width="280" height="380" rx="2" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <line x1="10" y1="200" x2="290" y2="200" stroke="rgba(255,255,255,0.18)" stroke-width="1.5"/>
            <circle cx="150" cy="200" r="36" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <circle cx="150" cy="200" r="3" fill="rgba(255,255,255,0.25)"/>
            <rect x="75" y="10" width="150" height="56" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <rect x="113" y="10" width="74" height="24" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <rect x="125" y="6" width="50" height="10" rx="2" stroke="rgba(255,255,255,0.25)" stroke-width="1" fill="rgba(255,255,255,0.04)"/>
            <rect x="75" y="334" width="150" height="56" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <rect x="113" y="366" width="74" height="24" stroke="rgba(255,255,255,0.18)" stroke-width="1.5" fill="none"/>
            <rect x="125" y="384" width="50" height="10" rx="2" stroke="rgba(255,255,255,0.25)" stroke-width="1" fill="rgba(255,255,255,0.04)"/>
            <circle cx="150" cy="54" r="2" fill="rgba(255,255,255,0.25)"/>
            <circle cx="150" cy="346" r="2" fill="rgba(255,255,255,0.25)"/>
          </svg>
          <div id="match-team-display" style="position:absolute;inset:0;"></div>
        </div>
      </div>
      <div>
        <div class="match-list-header" style="justify-content:flex-end"><div style="width:6px;height:6px;border-radius:50%;background:var(--river);box-shadow:0 0 6px var(--river);"></div>ELENCO RIVER</div>
        <div id="list-river"></div>
      </div>
    </div>
  </div>
</div>

<!-- COMPARISON MODAL -->
<div id="comparison-modal" class="modal-overlay">
  <div id="comparison-modal-inner">
    <div class="modal-close-btn" id="close-comparison-modal">&times;</div>
    <div style="font-family:var(--font-display);font-size:28px;letter-spacing:4px;text-align:center;margin-bottom:24px;">FACE A FACE</div>
    <div class="compare-selects">
      <div class="compare-select-wrap">
        <div class="compare-select-label" style="color:var(--boca)">JOGADOR 1</div>
        <select id="p1-select" class="compare-select" style="border-color:rgba(59,130,246,0.3)"></select>
      </div>
      <div class="vs-label">VS</div>
      <div class="compare-select-wrap">
        <div class="compare-select-label" style="color:var(--river)">JOGADOR 2</div>
        <select id="p2-select" class="compare-select" style="border-color:rgba(239,68,68,0.3)"></select>
      </div>
    </div>
    <div id="comparison-content" style="text-align:center;color:var(--text3);padding:20px 0;">Selecione dois jogadores para o duelo.</div>
    <div id="radar-container" style="display:none;justify-content:center;margin-top:16px">
      <div style="width:280px;height:280px;position:relative"><canvas id="radar-chart"></canvas></div>
    </div>
  </div>
</div>

<!-- FULL LIST MODAL -->
<div id="full-list-modal" class="modal-overlay">
  <div id="full-list-modal-inner">
    <div class="panel-header" style="flex-shrink:0;">
      <span class="panel-title" id="full-list-title">RANKING</span>
      <div class="modal-close-btn" id="close-full-list" style="position:static;width:28px;height:28px;font-size:16px;">&times;</div>
    </div>
    <div class="full-list-table" id="full-list-content"></div>
  </div>
</div>

<script>
// ==============================
// CONFIGURAÇÕES
// ==============================
const apiKey = "AIzaSyCL19ds6YqVOv5vV-zygBjeC-byy-rDPfM";
const spreadsheetId = "1TvrVT8ksYYMlpw8gkKIFvpnnCf02J8uYTkhHc5c0vdo";
const rangePagina1 = "Página1!A2:H100";
const rangePagina2 = "Página2!A2:L1000";

const clickAudio = new Audio("https://raw.githubusercontent.com/ittokki/Futebol/main/PES%202013%20Select%20Game%20Main%20Menu%20Sound%20Effect%20(mp3cut.net).mp3");
clickAudio.volume = 0.5;
document.addEventListener('click', () => { try { const s = clickAudio.cloneNode(); s.volume = 0.25; s.play().catch(()=>{}); } catch(e){} });

const playerPhotos = {
  "ADEMIR": "https://drive.google.com/thumbnail?id=19uLFnCc6T_EWK0Z2R1Nfw7Mi10a3LIdQ&sz=w500",
  "ALESSANDRO": "https://drive.google.com/thumbnail?id=1eGjTXt1wcG8aqEphPjZZMo2DGSAVTA2h&sz=w500",
  "ANDRIUS": "https://drive.google.com/thumbnail?id=1lBPpJryy0nosPEAJpwu-na-YfSfju_Hn&sz=w500",
  "BRUNO GUIMARAES": "https://drive.google.com/thumbnail?id=14WYCQ1C11-1VXMc5gXMrVkJAZKHkMy30&sz=w500",
  "CARLOS ALEXANDRE": "https://drive.google.com/thumbnail?id=1-lm5HqA2V_kRD9ETFY4jvLfwpCEzbcKM&sz=w500",
  "CHRISTIANO": "https://drive.google.com/thumbnail?id=1jh9wzyW-lIg9L9b-3qbBJfEVMnaA7Fny&sz=w500",
  "DOUGLAS DAITX": "https://drive.google.com/thumbnail?id=1kv305jEIO7C2u0x66lLQomZE1ECUR6Nk&sz=w500",
  "EDUARDO DUDU": "https://drive.google.com/thumbnail?id=1ieo-vpgcjWz3MaGA8hs5L0MxqJtxQDaq&sz=w500",
  "EVERTON": "https://drive.google.com/thumbnail?id=1gw-zhOl9_EwVAHq63wd1zaodD6PWhagG&sz=w500",
  "FRANCISCO CHICO": "https://drive.google.com/thumbnail?id=1cyklLvwHfJAsNz8aXJpNrrXfMcZY_Not&sz=w500",
  "GUSTAVO": "https://drive.google.com/thumbnail?id=1lYYKBFNSdxP3_azDHHiewLXQ6gHCzWNj&sz=w500",
  "HENRIQUE AMARAL": "https://drive.google.com/thumbnail?id=1V7_e555JZ9DlUtJXl-Q94_TxnRpyRS26&sz=w500",
  "HENRIQUE SILVA": "https://drive.google.com/thumbnail?id=1YMVMfLNkMG0hg1YjfmmFIa-4OvJuGIzk&sz=w500",
  "IAGO NUNES": "https://drive.google.com/thumbnail?id=19BAt94_apJXVWI1rnpNPfLnXG_dzr2IZ&sz=w500",
  "JUAREZ CARDOSO": "https://drive.google.com/thumbnail?id=1ylBwDdDDa6ZVXNS_gjNW0U5Hu2bDErHk&sz=w500",
  "LUCAS HENRIQUE": "https://drive.google.com/thumbnail?id=1RFSypiSjWo01lSXNh4YWsLUHMi0QhXz4&sz=w500",
  "LUCAS ZUCHI": "https://drive.google.com/thumbnail?id=1uahzfKtDDqK4s4lB2vrr3beYKN1Zx0AH&sz=w500",
  "MAICON": "https://drive.google.com/thumbnail?id=1dDxjhc3GHOu7YrCkX8EyxTC4A_x74Xnt&sz=w500",
  "MARCO DAITX": "https://drive.google.com/thumbnail?id=1kR_hlxSyD2HG_fdyNefcKIQFHkXXFFNG&sz=w500",
  "MATHEUS": "https://drive.google.com/thumbnail?id=1MyGNbFiF7uHhgIP2I7FqYgrizuxeR6aX&sz=w500",
  "PEDRALLI": "https://drive.google.com/thumbnail?id=1oxuryNnAVqHfU1u4Mg1lZ9YtUOKvkIK_&sz=w500",
  "THALES RAMOS": "https://drive.google.com/thumbnail?id=1lQQ5tWG1rMaQJj0ogkNUqyz1si5GwfkA&sz=w500",
  "VICTOR MATHEUS": "https://drive.google.com/thumbnail?id=1c3Cq36Bw2KCqpFCz6vwRr9gJ344gK4bo&sz=w500",
  "VITOR (GOL)": "https://drive.google.com/thumbnail?id=1iEwFEzr04iMtcJhd0a_jt_Th6Ca4pjEe&sz=w500",
  "WILIAN": "https://drive.google.com/thumbnail?id=1Pe30oPHtNC54iOzX1nrhdAbQQwWg2L5P&sz=w500",
  "WILLY": "https://drive.google.com/thumbnail?id=1epf6bJAQomcxDOtcdbGDLQDOM20x199j&sz=w500",
  "ZECA": "https://drive.google.com/thumbnail?id=1nijIMeVwsl9ApSSeu47QnK612JJXGYSL&sz=w500"
};

let allPlayersData = [], allMatchesData = [], chartInstances = {}, currentLayoutIs2026 = true;

// ==============================
// HELPERS
// ==============================
const parseNum = v => typeof v === "number" ? v : (Number((v||'').toString().replace(',', '.').trim()) || 0);
const norm = n => n ? n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").replace(/\(GOL\)/gi,"").trim().toUpperCase() : '';
const mapPos = p => { if(!p) return 'N/A'; p=p.toLowerCase(); if(p.includes('gol')) return 'gol'; if(p.includes('def')) return 'def'; if(p.includes('zag')) return 'zag'; if(p.includes('ala')) return 'ala'; if(p.includes('mei')) return 'mei'; if(p.includes('ata')) return 'ata'; return 'N/A'; };
const pos3 = p => { if(!p) return 'N/A'; p=p.toLowerCase(); if(p.includes('gol')) return 'GOL'; if(p.includes('def')) return 'DEF'; if(p.includes('zag')) return 'ZAG'; if(p.includes('ala')) return 'ALA'; if(p.includes('mei')) return 'MEI'; if(p.includes('ata')) return 'ATA'; return p.substring(0,3).toUpperCase(); };
const getPhoto = n => playerPhotos[n] || `https://ui-avatars.com/api/?name=${encodeURIComponent(n.split(' ')[0])}&background=21262d&color=8b949e&size=80`;

function calculateFIFAStats(player) {
  let ovr;
  if(player.jogos===0) ovr=60;
  else if(player.notaGeral>=6) ovr=60+((player.notaGeral-6)*9.5);
  else ovr=60-((6-player.notaGeral)*5);
  if(player.jogos<3) ovr=Math.min(ovr,75);
  ovr=Math.round(ovr);
  const gpg=player.gols/(player.jogos||1), apg=player.assistencias/(player.jogos||1), pos=player.posicaoPref;
  let base=ovr-12, pac=base, sho=base, pas=base, def=base, phy=base;
  const isDef=pos==='zag'||pos==='def';
  if(['ata','ala'].includes(pos)) pac=ovr-3; else if(pos==='mei') pac=ovr-12; else pac=ovr-15;
  let shoBonus=gpg*25;
  if(pos==='ata') sho=(ovr-6)+shoBonus; else if(['mei','ala'].includes(pos)) sho=(ovr-15)+shoBonus; else sho=(ovr-35)+shoBonus;
  let pasBonus=apg*30;
  if(['mei','ala'].includes(pos)) pas=(ovr-5)+pasBonus; else if(pos==='ata') pas=(ovr-18)+pasBonus; else pas=(ovr-22)+pasBonus;
  if(isDef||pos==='gol') def=ovr-3; else if(['ala','mei'].includes(pos)) def=ovr-22; else def=ovr-45;
  let phyBonus=Math.min(8,player.jogos/2);
  if(isDef||pos==='gol') phy=(ovr-5)+phyBonus; else phy=(ovr-18)+phyBonus;
  const boost=(v,t)=>Math.max(v,t);
  if(pos==='ata'){sho=boost(sho,ovr-2);pac=boost(pac,ovr-5);}else if(pos==='ala'){pac=boost(pac,ovr-2);pas=boost(pas,ovr-6);}else if(pos==='mei'){pas=boost(pas,ovr-2);sho=boost(sho,ovr-10);}else if(isDef){def=boost(def,ovr-2);phy=boost(phy,ovr-4);}else if(pos==='gol'){def=boost(def,ovr-1);phy=boost(phy,ovr-3);}
  const clamp=n=>Math.max(40,Math.min(99,Math.round(n)));
  let cssClass='silver';
  if(ovr>=90) cssClass='special'; else if(ovr>=85) cssClass='special'; else if(ovr>=75) cssClass='gold';
  return {ovr:clamp(ovr),pac:clamp(pac),sho:clamp(sho),pas:clamp(pas),def:clamp(def),phy:clamp(phy),cssClass};
}

function calculateConquistas(player, partidas) {
  const c=[];
  partidas.forEach(p=>{
    if(p.gols>=5) c.push({nome:"Repoker",desc:"5 Gols",icon:"fa-star",rarity:"mitico"});
    else if(p.gols>=4) c.push({nome:"Poker",desc:"4 Gols",icon:"fa-dice-four",rarity:"lendario"});
    else if(p.gols>=3) c.push({nome:"Hat-Trick",desc:"3 Gols",icon:"fa-futbol",rarity:"epico"});
    if(p.assistencias>=4) c.push({nome:"Maestro",desc:"4 Assist",icon:"fa-wand-magic-sparkles",rarity:"lendario"});
    if(p.notaPartida>=9.5) c.push({nome:"Lenda",desc:"Nota 9.5+",icon:"fa-crown",rarity:"mitico"});
  });
  if(player.jogos>=50) c.push({nome:"Veterano",desc:"50 Jogos",icon:"fa-shield-halved",rarity:"lendario"});
  return c;
}

function calculateSelectionCount(matches) {
  const dates=[...new Set(matches.filter(m=>m.jogoAconteceu).map(m=>m.dataJogo))];
  const counts={};
  dates.forEach(date=>{
    const dm=matches.filter(m=>m.dataJogo===date&&m.jogoAconteceu);
    const getBest=(posArr,limit)=>dm.filter(p=>posArr.includes(p.posicao)).sort((a,b)=>b.notaPartida-a.notaPartida).slice(0,limit);
    let sel=[];
    if(date.endsWith('2026')) sel=[...getBest(['gol'],1),...getBest(['def','zag'],2),...getBest(['mei','ala'],3),...getBest(['ata'],1)];
    else sel=[...getBest(['gol'],1),...getBest(['zag'],1),...getBest(['ala'],2),...getBest(['mei'],1),...getBest(['ata'],2)];
    sel.forEach(p=>{counts[p.nome]=(counts[p.nome]||0)+1;});
  });
  return counts;
}

function processDataForPeriod(matches, playersRaw) {
  const selCounts=calculateSelectionCount(matches);
  const pm=new Map();
  playersRaw.forEach(r=>{ const n=norm(r[1]); if(n) pm.set(n,{nome:n,nomeOriginal:r[1],stats:{jogos:0,gols:0,ass:0,notas:[],posicoes:[],jogosGol:0,golsTomados:0,vitorias:0},partidas:[]}); });
  matches.forEach(m=>{
    if(m.jogoAconteceu&&pm.has(m.nome)){
      const p=pm.get(m.nome);
      p.stats.jogos++;p.stats.gols+=m.gols;p.stats.ass+=m.assistencias;
      p.stats.notas.push(m.notaPartida);p.stats.posicoes.push(m.posicao);
      p.stats.vitorias+=(m.vitoria===1?1:0);
      if(m.isGoleiro){p.stats.jogosGol++;p.stats.golsTomados+=m.golsTomados;}
      p.partidas.push(m);
    }
  });
  return Array.from(pm.values()).map(p=>{
    const ng=p.stats.notas.length?p.stats.notas.reduce((a,b)=>a+b,0)/p.stats.notas.length:0;
    const pc=p.stats.posicoes.reduce((a,pos)=>{a[pos]=(a[pos]||0)+1;return a;},{});
    const pp=Object.keys(pc).sort((a,b)=>pc[b]-pc[a])[0]||'N/A';
    const obj={
      nome:p.nome,nomeOriginal:p.nomeOriginal,
      jogos:p.stats.jogos,gols:p.stats.gols,assistencias:p.stats.ass,vitorias:p.stats.vitorias,
      notaGeral:ng,posicaoPref:pp,partidas:p.partidas,
      mediaGolsSofridos:p.stats.jogosGol>0?(p.stats.golsTomados/p.stats.jogosGol):null,
      jogosGoleiro:p.stats.jogosGol,
      ga:p.stats.gols+p.stats.ass,
      aproveitamento:p.stats.jogos>0?(p.stats.vitorias/p.stats.jogos)*100:0,
      selectionCount:selCounts[p.nome]||0,
      nivel:ng>=9?'LENDA':ng>=8?'CRAQUE':ng>=7?'DIFERENCIADO':ng>=6?'ESFORÇADO':'INICIANTE'
    };
    obj.fifa=calculateFIFAStats(obj);
    obj.conquistas=calculateConquistas(obj,obj.partidas);
    return obj;
  }).filter(p=>p.jogos>0);
}

// ==============================
// INIT
// ==============================
async function initData() {
  try {
    const fetchSheet = async rng => {
      const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${rng}?key=${apiKey}`);
      return (await res.json()).values||[];
    };
    const [partidasRaw,jogadoresRaw] = await Promise.all([fetchSheet(rangePagina2),fetchSheet(rangePagina1)]);

    allMatchesData = partidasRaw.map(row=>({
      nome:norm(row[0]),nomeRaw:row[0],
      gols:parseNum(row[1]),assistencias:parseNum(row[2]),
      golsTomados:parseNum(row[3]),golsContra:parseNum(row[4]),
      notaADM:parseNum(row[5]),dataJogo:row[6],
      vitoria:(row[7]||"").toLowerCase().trim()==='sim'?1:(row[7]||"").toLowerCase().trim()==='empate'?0.5:0,
      time:row[8]||'N/A',
      jogoAconteceu:(row[10]||"").toLowerCase()==='sim',
      isGoleiro:(row[0]||"").toUpperCase().includes('(GOL)')||parseNum(row[3])>0,
      posicao:mapPos(row[11])
    })).filter(p=>p.nome&&/^\d{2}\/\d{2}\/\d{4}$/.test(p.dataJogo));

    allMatchesData.forEach(p=>{
      if(p.jogoAconteceu){
        const base=6.0+(p.gols*0.7)+(p.assistencias*0.6)+(p.isGoleiro?p.golsTomados*-0.15:0)+(p.golsContra*-1.5);
        let pond=(base+(p.notaADM*5))/6;
        p.notaPartida=Math.max(0,Math.min(10,pond+(p.vitoria===1?0.3:p.vitoria===0.5?0.15:0)));
      } else p.notaPartida=0;
    });

    const filterMain = document.getElementById('month-filter');
    const filterMobile = document.getElementById('month-filter-mobile');
    const seasons={'2026':[],'2025':[]};
    allMatchesData.forEach(m=>{
      const parts=m.dataJogo.split('/'), month=m.dataJogo.substring(3), year=parts[2];
      if(seasons[year]&&!seasons[year].includes(month)) seasons[year].push(month);
    });

    const buildOpts = ()=>{
      let html='<option value="2026-ALL">Temporada 2026 (Atual)</option>';
      seasons['2026'].sort((a,b)=>new Date(b.split('/').reverse().join('-'))-new Date(a.split('/').reverse().join('-'))).forEach(m=>{
        const [mm,yyyy]=m.split('/'); const d=new Date(yyyy,mm-1); const nm=d.toLocaleString('pt-BR',{month:'long'});
        html+=`<option value="${m}">${nm.charAt(0).toUpperCase()+nm.slice(1)}/26</option>`;
      });
      html+='<option value="2025-ALL">Temporada 2025 (Arquivo)</option>';
      seasons['2025'].sort((a,b)=>new Date(b.split('/').reverse().join('-'))-new Date(a.split('/').reverse().join('-'))).forEach(m=>{
        const [mm,yyyy]=m.split('/'); const d=new Date(yyyy,mm-1); const nm=d.toLocaleString('pt-BR',{month:'long'});
        html+=`<option value="${m}">${nm.charAt(0).toUpperCase()+nm.slice(1)}/25</option>`;
      });
      return html;
    };
    filterMain.innerHTML = filterMobile.innerHTML = buildOpts();

    const applyFilter = val => {
      let fm=[];
      if(val==='2026-ALL') fm=allMatchesData.filter(m=>m.dataJogo.endsWith('2026'));
      else if(val==='2025-ALL') fm=allMatchesData.filter(m=>m.dataJogo.endsWith('2025'));
      else fm=allMatchesData.filter(m=>m.dataJogo.substring(3)===val);
      allPlayersData=processDataForPeriod(fm,jogadoresRaw);
      currentLayoutIs2026=val.includes('2026');
      updateDashboard(allPlayersData,fm);
    };

    filterMain.addEventListener('change',()=>{ filterMobile.value=filterMain.value; applyFilter(filterMain.value); });
    filterMobile.addEventListener('change',()=>{ filterMain.value=filterMobile.value; applyFilter(filterMobile.value); });

    const initMatches = allMatchesData.filter(m=>m.dataJogo.endsWith('2026'));
    allPlayersData = processDataForPeriod(initMatches,jogadoresRaw);
    currentLayoutIs2026 = true;
    setupEventListeners();
    updateDashboard(allPlayersData,initMatches);
    document.getElementById('loading').style.display='none';

  } catch(e) {
    console.error(e);
    document.getElementById('loading').innerHTML=`<div style="color:#ef4444;font-family:var(--font-mono);font-size:12px;padding:20px;text-align:center">ERRO AO CARREGAR<br>${e.message}</div>`;
  }
}

function setupEventListeners() {
  // Desktop nav
  document.querySelectorAll('#sidebar .nav-item[data-tab]').forEach(btn=>{
    btn.addEventListener('click',()=>switchTab(btn.dataset.tab));
  });
  document.getElementById('btn-compare-side').addEventListener('click',()=>openModal('comparison-modal'));
  document.getElementById('btn-update-side').addEventListener('click',()=>location.reload());
  document.getElementById('btn-compare').addEventListener('click',()=>{ openModal('comparison-modal'); setupComparisonTool(); });
  document.getElementById('btn-update').addEventListener('click',()=>location.reload());

  // Mobile menu
  document.getElementById('mobile-menu-btn').addEventListener('click',()=>{ document.getElementById('mobile-menu-overlay').classList.add('open'); });
  document.getElementById('close-mobile-menu').addEventListener('click',()=>{ document.getElementById('mobile-menu-overlay').classList.remove('open'); });
  document.querySelectorAll('.mobile-nav-item[data-tab]').forEach(btn=>{
    btn.addEventListener('click',()=>{ switchTab(btn.dataset.tab); document.getElementById('mobile-menu-overlay').classList.remove('open'); });
  });
  document.getElementById('mob-compare').addEventListener('click',()=>{ document.getElementById('mobile-menu-overlay').classList.remove('open'); openModal('comparison-modal'); setupComparisonTool(); });
  document.getElementById('mob-update').addEventListener('click',()=>location.reload());
  document.getElementById('player-search-mobile').addEventListener('input',e=>{ document.getElementById('player-search').value=e.target.value; renderRankings(allPlayersData); });

  // Modals close
  document.getElementById('close-player-modal').addEventListener('click',()=>closeModal('player-modal'));
  document.getElementById('close-match-modal').addEventListener('click',()=>closeModal('match-modal'));
  document.getElementById('close-comparison-modal').addEventListener('click',()=>closeModal('comparison-modal'));
  document.getElementById('close-full-list').addEventListener('click',()=>closeModal('full-list-modal'));
  ['player-modal','match-modal','comparison-modal','full-list-modal'].forEach(id=>{
    document.getElementById(id).addEventListener('click',e=>{ if(e.target.id===id) closeModal(id); });
  });

  // Search
  document.getElementById('player-search').addEventListener('input',()=>renderRankings(allPlayersData));

  // Print buttons
  document.getElementById('print-player-btn').addEventListener('click',()=>{ document.getElementById('player-modal').classList.toggle('print-active'); });
  document.getElementById('print-match-btn').addEventListener('click',()=>{ document.getElementById('match-modal').classList.toggle('print-active'); });
}

function switchTab(id) {
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item[data-tab]').forEach(b=>{ b.classList.toggle('active',b.dataset.tab===id); });
  document.querySelectorAll('.mobile-nav-item[data-tab]').forEach(b=>{ b.classList.toggle('active',b.dataset.tab===id); });
}
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); document.getElementById(id).classList.remove('print-active'); }

function updateDashboard(players, matches) {
  renderQuickStats(players, matches);
  renderHero(players);
  renderSpotlights(players);
  renderRankings(players);
  renderSelectionField(players);
  renderDraftList(players);
  renderHistory(matches);
  renderHall(players);
  renderStatsCharts(players, matches);
  renderFunFacts(players, matches);
}

// ==============================
// QUICK STATS
// ==============================
function renderQuickStats(players, matches) {
  const totalGols = matches.filter(m=>m.jogoAconteceu).reduce((a,b)=>a+b.gols,0);
  const totalJogos = [...new Set(matches.filter(m=>m.jogoAconteceu).map(m=>m.dataJogo))].length;
  const topScorer = [...players].sort((a,b)=>b.gols-a.gols)[0];
  const melhorNota = [...players].sort((a,b)=>b.notaGeral-a.notaGeral)[0];
  const mediaGeral = players.length ? (players.reduce((a,b)=>a+b.notaGeral,0)/players.length).toFixed(1) : 0;
  const items = [
    { label: 'GOLS', val: totalGols, sub: 'na temporada', color: '#22c55e' },
    { label: 'PARTIDAS', val: totalJogos, sub: 'realizadas', color: '#00e5ff' },
    { label: 'ARTILHEIRO', val: topScorer?topScorer.gols:0, sub: topScorer?topScorer.nomeOriginal.split(' ')[0]:'--', color: '#f59e0b' },
    { label: 'TOP NOTA', val: melhorNota?melhorNota.notaGeral.toFixed(1):0, sub: melhorNota?melhorNota.nomeOriginal.split(' ')[0]:'--', color: '#c084fc' },
    { label: 'MÉDIA GRUPO', val: mediaGeral, sub: 'de nota', color: '#60a5fa' },
    { label: 'JOGADORES', val: players.length, sub: 'ativos', color: '#f87171' },
  ];
  document.getElementById('quick-stats').innerHTML = items.map(i=>`
    <div class="qs-item">
      <div class="qs-item-label">${i.label}</div>
      <div class="qs-item-val" style="color:${i.color}">${i.val}</div>
      <div class="qs-item-sub">${i.sub}</div>
      <div class="qs-accent" style="background:${i.color};opacity:0.5"></div>
    </div>
  `).join('');
}

// ==============================
// HERO
// ==============================
function renderHero(players) {
  if(!players.length) { document.getElementById('hero-section').style.display='none'; return; }
  const cands = players.filter(p=>p.jogos>=2);
  const hero = (cands.length?cands:players).sort((a,b)=>b.notaGeral-a.notaGeral)[0];
  if(!hero) { document.getElementById('hero-section').style.display='none'; return; }
  document.getElementById('hero-section').style.display='block';
  document.getElementById('hero-img').src = getPhoto(hero.nome);
  document.getElementById('hero-name').innerText = hero.nomeOriginal;
  document.getElementById('hero-rating').innerText = hero.notaGeral.toFixed(2);
  document.getElementById('hero-goals').innerText = hero.gols;
  document.getElementById('hero-assists').innerText = hero.assistencias;
  document.getElementById('hero-games').innerText = hero.jogos;
}

// ==============================
// SPOTLIGHTS
// ==============================
function renderSpotlights(players) {
  const garcom = [...players].sort((a,b)=>b.assistencias-a.assistencias)[0];
  const topS = [...players].sort((a,b)=>b.gols-a.gols)[0];
  const gks = players.filter(p=>p.jogosGoleiro>=3).sort((a,b)=>a.mediaGolsSofridos-b.mediaGolsSofridos);
  const gk = gks[0];

  const mkCard = (label, player, val, color) => player ? `
    <div class="stat-card" onclick="openPlayerModal('${player.nome}')">
      <div class="stat-card-accent" style="background:${color}"></div>
      <div class="stat-card-label">${label}</div>
      <div class="stat-card-main">
        <img src="${getPhoto(player.nome)}" class="stat-card-img" onerror="this.src='${getPhoto(player.nome)}'">
        <div>
          <div class="stat-card-name">${player.nomeOriginal.split(' ')[0]}</div>
          <div class="stat-card-val">${val}</div>
        </div>
      </div>
    </div>
  ` : `<div class="stat-card"><div class="stat-card-label">${label}</div><div class="stat-card-val" style="color:var(--text3)">Sem dados</div></div>`;

  document.getElementById('hub-spotlights').innerHTML =
    mkCard('GARÇOM', garcom, `${garcom?garcom.assistencias:0} assistências`, '#f59e0b') +
    mkCard('ARTILHEIRO', topS, `${topS?topS.gols:0} gols`, '#22c55e') +
    mkCard('PAREDÃO (GK)', gk, gk?`${gk.mediaGolsSofridos.toFixed(2)} gols/jogo`:'Sem dados suficientes', '#00e5ff');
}

// ==============================
// RANKINGS
// ==============================
function renderRankings(players) {
  const grid = document.getElementById('rankings-grid'); grid.innerHTML='';
  const term = document.getElementById('player-search').value.toLowerCase();
  const filtered = players.filter(p=>p.nomeOriginal.toLowerCase().includes(term));

  const makeRankCard = (title, icon, key, unit='', reverse=false, src=filtered, decimals=0, minJogos=0) => {
    const sortable = minJogos>0 ? src.filter(p=>p.jogos>=minJogos) : src;
    const sorted = [...sortable].sort((a,b)=>reverse?a[key]-b[key]:b[key]-a[key]);
    const top5 = sorted.slice(0,5);
    const rows = top5.map((p,i)=>{
      const v = typeof p[key]==='number' ? (decimals>0?p[key].toFixed(decimals):p[key]) : p[key];
      return `<div class="rank-row" onclick="openPlayerModal('${p.nome}')">
        <span class="rank-pos ${i===0?'p1':i===1?'p2':i===2?'p3':''}">${i+1}</span>
        <img src="${getPhoto(p.nome)}" class="rank-row-img" onerror="this.style.display='none'">
        <span class="rank-row-name">${p.nomeOriginal.split(' ')[0]}</span>
        <span class="rank-row-val">${v}${unit}</span>
      </div>`;
    }).join('');
    return `<div class="rank-card">
      <div class="rank-card-header">
        <span class="rank-card-title">${title}</span>
        <span class="rank-card-icon">${icon}</span>
      </div>
      ${rows}
      <div class="rank-see-more" onclick="openFullRanking('${title}','${key}',${reverse},${decimals})">VER TODOS ↓</div>
    </div>`;
  };

  grid.innerHTML += makeRankCard('NOTA GERAL','⭐','notaGeral','',false,filtered,2);
  grid.innerHTML += makeRankCard('SELEÇÕES','🏆','selectionCount','x');
  grid.innerHTML += makeRankCard('ARTILHEIRO','⚽','gols','');
  grid.innerHTML += makeRankCard('ASSISTÊNCIAS','🎯','assistencias','');
  grid.innerHTML += makeRankCard('G+A','💎','ga','');
  grid.innerHTML += makeRankCard('VITÓRIAS','🥇','vitorias','V');
  const gks = filtered.filter(p=>p.jogosGoleiro>=3);
  if(gks.length>0) grid.innerHTML += makeRankCard('GOLEIROS (MÉDIA)','🧤','mediaGolsSofridos','',true,gks,2);
  grid.innerHTML += makeRankCard('APROVEITAMENTO','📈','aproveitamento','%',false,filtered,1,3);
}

window.openFullRanking = (title, key, reverse, decimals=0) => {
  const sorted = [...allPlayersData].sort((a,b)=>reverse?a[key]-b[key]:b[key]-a[key]);
  let html='';
  sorted.forEach((p,i)=>{
    const v=typeof p[key]==='number'?(decimals>0?p[key].toFixed(decimals):p[key]):p[key];
    html+=`<div class="full-list-row" onclick="openPlayerModal('${p.nome}')">
      <span style="font-family:var(--font-mono);font-size:12px;width:22px;color:${i<3?'var(--accent3)':'var(--text3)'};font-weight:700;">${i+1}</span>
      <img src="${getPhoto(p.nome)}" style="width:32px;height:32px;border-radius:50%;object-fit:cover;" onerror="this.style.display='none'">
      <span style="flex:1;font-size:13px;font-weight:600;color:var(--text)">${p.nomeOriginal}</span>
      <span style="font-family:var(--font-mono);font-size:13px;font-weight:700;color:var(--accent)">${v}</span>
    </div>`;
  });
  document.getElementById('full-list-title').innerText=title;
  document.getElementById('full-list-content').innerHTML=html;
  openModal('full-list-modal');
};

// ==============================
// PITCH / SELECTION
// ==============================
function renderSelectionField(players) {
  const pitch = document.getElementById('pitch-players');
  let html='';
  const renderP = (p, xPct, yPct) => `
    <div class="pitch-player" style="left:${xPct}%;top:${yPct}%" onclick="openPlayerModal('${p.nome}')">
      <div class="pitch-player-img-wrap">
        <img src="${getPhoto(p.nome)}" class="pitch-player-img" onerror="this.src='${getPhoto(p.nome)}'">
        <div class="pitch-player-rating">${p.notaGeral.toFixed(1)}</div>
      </div>
      <div class="pitch-player-name">${p.nomeOriginal.split(' ')[0]}</div>
    </div>`;

  if(currentLayoutIs2026) {
    const getBest=(posArr,count)=>players.filter(p=>posArr.includes(p.posicaoPref)).sort((a,b)=>b.notaGeral-a.notaGeral).slice(0,count);
    const gols=getBest(['gol'],1), defs=getBest(['def','zag'],2), meis=getBest(['mei','ala'],3), atas=getBest(['ata'],1);
    if(gols[0]) html+=renderP(gols[0],50,88);
    if(defs[0]) html+=renderP(defs[0],28,68); if(defs[1]) html+=renderP(defs[1],72,68);
    if(meis[0]) html+=renderP(meis[0],50,48); if(meis[1]) html+=renderP(meis[1],18,48); if(meis[2]) html+=renderP(meis[2],82,48);
    if(atas[0]) html+=renderP(atas[0],50,14);
  } else {
    const getBest=(pos,count)=>players.filter(p=>p.posicaoPref===pos).sort((a,b)=>b.notaGeral-a.notaGeral).slice(0,count);
    const gols=getBest('gol',1),zag=getBest('zag',1),ala=getBest('ala',2),mei=getBest('mei',1),ata=getBest('ata',2);
    if(gols[0]) html+=renderP(gols[0],50,88);
    if(zag[0]) html+=renderP(zag[0],50,70);
    if(ala[0]) html+=renderP(ala[0],20,50); if(ala[1]) html+=renderP(ala[1],80,50);
    if(mei[0]) html+=renderP(mei[0],50,48);
    if(ata[0]) html+=renderP(ata[0],30,16); if(ata[1]) html+=renderP(ata[1],70,16);
  }
  pitch.innerHTML=html;
  const sel=document.getElementById('month-filter');
  document.getElementById('team-period-label').innerText=sel.options[sel.selectedIndex]?.text||'';
}

// ==============================
// DRAFT
// ==============================
function renderDraftList(players) {
  const list=document.getElementById('draft-list');
  list.innerHTML=players.sort((a,b)=>a.nomeOriginal.localeCompare(b.nomeOriginal)).map(p=>`
    <div class="draft-player-row" id="draft-row-${p.nome.replace(/\s/g,'-')}" onclick="toggleDraft('${p.nome}')">
      <div class="draft-checkbox" id="chk-${p.nome.replace(/\s/g,'-')}"></div>
      <input type="checkbox" value="${p.nome}" class="draft-chk" data-pos="${p.posicaoPref}" style="display:none">
      <img src="${getPhoto(p.nome)}" style="width:24px;height:24px;border-radius:50%;object-fit:cover;opacity:0.7" onerror="this.style.display='none'">
      <span class="draft-player-row-name">${p.nomeOriginal}</span>
      <span class="draft-player-row-pos">${pos3(p.posicaoPref)}</span>
      <span class="draft-player-row-ovr">${p.fifa.ovr}</span>
    </div>`).join('');
}

window.toggleDraft = nome => {
  const safeId = nome.replace(/\s/g,'-');
  const chk = document.getElementById('chk-'+safeId);
  const inp = document.querySelector(`#draft-row-${safeId} .draft-chk`);
  const row = document.getElementById('draft-row-'+safeId);
  if(!chk||!inp) return;
  inp.checked=!inp.checked;
  chk.classList.toggle('checked',inp.checked);
  row.classList.toggle('selected',inp.checked);
  document.getElementById('selected-count').innerText=`${document.querySelectorAll('.draft-chk:checked').length} JOG`;
};
function selectAll() { document.querySelectorAll('.draft-chk').forEach(c=>{ if(!c.checked) window.toggleDraft(c.value); }); }
function clearAll() { document.querySelectorAll('.draft-chk:checked').forEach(c=>{ window.toggleDraft(c.value); }); }

function generateTeams() {
  const selected = Array.from(document.querySelectorAll('.draft-chk:checked'));
  if(selected.length<2) return;
  const pool = allPlayersData.filter(p=>selected.some(s=>s.value===p.nome));
  const gks=pool.filter(p=>p.posicaoPref==='gol').sort((a,b)=>b.fifa.ovr-a.fifa.ovr);
  const out=pool.filter(p=>p.posicaoPref!=='gol').sort((a,b)=>b.fifa.ovr-a.fifa.ovr);
  const tA=[],tB=[];
  if(gks[0]) tA.push(gks[0]); if(gks[1]) tB.push(gks[1]); if(gks.length>2) out.push(...gks.slice(2));
  out.forEach((p,i)=>{ if(i%4===0||i%4===3) tB.push(p); else tA.push(p); });
  const avg=t=>(t.reduce((a,p)=>a+p.fifa.ovr,0)/t.length).toFixed(1);
  const oa=avg(tA),ob=avg(tB);
  const renderRow=p=>`<div class="team-result-row"><span>${p.nomeOriginal}</span><span style="font-family:var(--font-mono);font-size:11px;color:var(--accent3)">${p.fifa.ovr}</span></div>`;
  document.getElementById('list-team-a').innerHTML=tA.map(renderRow).join('');
  document.getElementById('list-team-b').innerHTML=tB.map(renderRow).join('');
  document.getElementById('stats-team-a').innerText=`OVR ${oa}`;
  document.getElementById('stats-team-b').innerText=`OVR ${ob}`;
  const diff=parseFloat(oa)-parseFloat(ob);
  const msg=Math.abs(diff)<2?'⚖️ Times equilibrados! Vai ser tenso.':diff>0?`💪 Time A favorito (+${Math.abs(diff).toFixed(1)} OVR). Mas o futebol é imprevisível!`:`💪 Time B favorito (+${Math.abs(diff).toFixed(1)} OVR). Mas o futebol é imprevisível!`;
  document.getElementById('verdict-text').innerText=msg;
  document.getElementById('verdict-panel').style.display='flex';
  document.getElementById('teams-container').style.display='grid';
}

// ==============================
// HISTORY
// ==============================
function renderHistory(matches) {
  const dates=[...new Set(matches.map(m=>m.dataJogo))].sort((a,b)=>new Date(b.split('/').reverse().join('-'))-new Date(a.split('/').reverse().join('-')));
  document.getElementById('matches-list').innerHTML=dates.map(d=>{
    const ms=matches.filter(m=>m.dataJogo===d);
    const happened=ms.some(x=>x.jogoAconteceu);
    const golsBoca=ms.filter(x=>x.time.toUpperCase().includes('BOCA')).reduce((a,b)=>a+b.gols,0);
    const contraBoca=ms.filter(x=>x.time.toUpperCase().includes('BOCA')).reduce((a,b)=>a+b.golsContra,0);
    const golsRiver=ms.filter(x=>x.time.toUpperCase().includes('RIVER')).reduce((a,b)=>a+b.gols,0);
    const contraRiver=ms.filter(x=>x.time.toUpperCase().includes('RIVER')).reduce((a,b)=>a+b.golsContra,0);
    const pA=golsBoca+contraRiver, pB=golsRiver+contraBoca;
    return `<div class="history-item" onclick="openMatchModal('${d}')">
      <span class="history-item-date">${d}</span>
      ${happened?`<div class="history-score"><span class="boca">BOCA ${pA}</span><span class="sep">×</span><span class="river">${pB} RIVER</span></div>`:
      `<span class="history-badge pending">AGENDADO</span>`}
      <div style="display:flex;align-items:center;gap:6px;color:var(--text3);font-size:12px;"><i class="fas fa-chevron-right"></i></div>
    </div>`;
  }).join('');
}

// ==============================
// HALL
// ==============================
function renderHall(players) {
  const top=players.filter(p=>p.conquistas.length>0||p.nivel==='LENDA').sort((a,b)=>b.conquistas.length-a.conquistas.length);
  document.getElementById('hall-grid').innerHTML=top.length?top.map(p=>`
    <div class="hall-card" onclick="openPlayerModal('${p.nome}')">
      <img src="${getPhoto(p.nome)}" class="hall-card-img" onerror="this.style.background='var(--surface3)'">
      <div class="hall-card-name">${p.nomeOriginal.split(' ')[0]}</div>
      <div class="hall-trophy-count">${p.conquistas.length} conquista${p.conquistas.length!==1?'s':''} <i class="fas fa-trophy"></i></div>
      <div class="hall-conquistas">${p.conquistas.slice(0,6).map(c=>`<div class="conquista-dot conquista-${c.rarity}" title="${c.nome}: ${c.desc}"></div>`).join('')}</div>
    </div>`).join('')
    :'<p style="color:var(--text3);grid-column:1/-1;text-align:center;padding:40px;font-family:var(--font-mono);font-size:12px;letter-spacing:2px;">SEM CONQUISTAS NESTA TEMPORADA</p>';
}

// ==============================
// STATS CHARTS
// ==============================
function renderStatsCharts(players, matches) {
  const defOpts = (title, color) => ({
    responsive:true, maintainAspectRatio:false,
    plugins:{legend:{display:false},title:{display:true,text:title,color:'#8b949e',font:{family:'Space Mono',size:10},padding:{bottom:10}}},
    scales:{y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#484f58',font:{size:10}},border:{color:'transparent'}},
            x:{grid:{display:false},ticks:{color:'#484f58',font:{size:10}},border:{color:'transparent'}}}
  });
  const createBar = (id, label, data, color) => {
    if(chartInstances[id]) chartInstances[id].destroy();
    const ctx=document.getElementById(id); if(!ctx) return;
    const sorted=data.sort((a,b)=>b.v-a.v).slice(0,10);
    chartInstances[id]=new Chart(ctx,{type:'bar',data:{labels:sorted.map(x=>x.n),datasets:[{data:sorted.map(x=>x.v),backgroundColor:color+'44',borderColor:color,borderWidth:1,borderRadius:4}]},options:defOpts(label,color)});
  };
  createBar('chart-gols','TOP ARTILHEIROS',players.map(p=>({n:p.nomeOriginal.split(' ')[0],v:p.gols})),'#22c55e');
  createBar('chart-assists','TOP ASSISTÊNCIAS',players.map(p=>({n:p.nomeOriginal.split(' ')[0],v:p.assistencias})),'#f59e0b');
  createBar('chart-games','MAIS JOGOS',players.map(p=>({n:p.nomeOriginal.split(' ')[0],v:p.jogos})),'#60a5fa');
  if(chartInstances['group']) chartInstances['group'].destroy();
  const ctxG=document.getElementById('chart-group-goals'); if(!ctxG) return;
  const months={}; matches.filter(m=>m.jogoAconteceu).forEach(m=>{const k=m.dataJogo.substring(3);months[k]=(months[k]||0)+m.gols;});
  const labels=Object.keys(months).sort((a,b)=>new Date(a.split('/').reverse().join('-'))-new Date(b.split('/').reverse().join('-')));
  chartInstances['group']=new Chart(ctxG,{type:'line',data:{labels,datasets:[{data:labels.map(l=>months[l]),borderColor:'#00e5ff',backgroundColor:'rgba(0,229,255,0.06)',fill:true,tension:0.4,pointRadius:4,pointBackgroundColor:'#00e5ff',borderWidth:2}]},options:{...defOpts('EVOLUÇÃO MENSAL DE GOLS','#00e5ff')}});
}

// ==============================
// FUN FACTS
// ==============================
function renderFunFacts(players, matches) {
  const facts=[];
  const bestMatch=matches.filter(m=>m.jogoAconteceu).sort((a,b)=>b.notaPartida-a.notaPartida)[0];
  if(bestMatch) facts.push({icon:'fa-star',color:'#f59e0b',bg:'rgba(245,158,11,0.1)',title:'Atuação de Gala',text:`Maior nota: <strong>${bestMatch.notaPartida.toFixed(1)}</strong> por <strong>${bestMatch.nomeRaw.split(' ')[0]}</strong> em ${bestMatch.dataJogo}.`});
  const goalsByDate={}; matches.filter(m=>m.jogoAconteceu).forEach(m=>goalsByDate[m.dataJogo]=(goalsByDate[m.dataJogo]||0)+m.gols);
  const topDate=Object.keys(goalsByDate).sort((a,b)=>goalsByDate[b]-goalsByDate[a])[0];
  if(topDate) facts.push({icon:'fa-cloud-showers-heavy',color:'#60a5fa',bg:'rgba(59,130,246,0.1)',title:'Chuva de Gols',text:`<strong>${topDate}</strong> teve o recorde: <strong>${goalsByDate[topDate]}</strong> gols marcados.`});
  const lucky=players.filter(p=>p.jogos>=5).sort((a,b)=>b.aproveitamento-a.aproveitamento)[0];
  if(lucky) facts.push({icon:'fa-gem',color:'#c084fc',bg:'rgba(192,132,252,0.1)',title:'Amuleto da Sorte',text:`<strong>${lucky.nomeOriginal.split(' ')[0]}</strong> tem o melhor aproveitamento: <strong>${lucky.aproveitamento.toFixed(0)}%</strong> (mín. 5 jogos).`});
  const zagArt=players.filter(p=>p.posicaoPref==='zag'||p.posicaoPref==='def').sort((a,b)=>b.gols-a.gols)[0];
  if(zagArt&&zagArt.gols>0) facts.push({icon:'fa-shield-alt',color:'#22c55e',bg:'rgba(34,197,94,0.1)',title:'Zagueiro Artilheiro',text:`<strong>${zagArt.nomeOriginal.split(' ')[0]}</strong> é o defensor com mais gols: <strong>${zagArt.gols}</strong>.`});
  const maq=players.filter(p=>p.jogos>=3).sort((a,b)=>(b.gols/b.jogos)-(a.gols/a.jogos))[0];
  if(maq) facts.push({icon:'fa-robot',color:'#ef4444',bg:'rgba(239,68,68,0.1)',title:'Máquina de Gols',text:`<strong>${maq.nomeOriginal.split(' ')[0]}</strong>: <strong>${(maq.gols/maq.jogos).toFixed(2)}</strong> gols por jogo.`});
  const inv=players.filter(p=>p.jogos>=3).sort((a,b)=>(b.ga/b.jogos)-(a.ga/a.jogos))[0];
  if(inv) facts.push({icon:'fa-handshake',color:'#00e5ff',bg:'rgba(0,229,255,0.1)',title:'O Onipresente',text:`<strong>${inv.nomeOriginal.split(' ')[0]}</strong> participa de <strong>${(inv.ga/inv.jogos).toFixed(1)}</strong> gols por jogo.`});
  const gcPlayers = players.map(p=>({...p, gcs: p.partidas.reduce((a,m)=>a+m.golsContra,0)})).filter(p=>p.gcs>0).sort((a,b)=>b.gcs-a.gcs);
  if(gcPlayers[0]) facts.push({icon:'fa-person-falling',color:'#f87171',bg:'rgba(248,113,113,0.1)',title:'Goleiro do Adversário',text:`<strong>${gcPlayers[0].nomeOriginal.split(' ')[0]}</strong> marcou <strong>${gcPlayers[0].gcs}</strong> gol(s) contra.`});

  document.getElementById('curiosities-grid').innerHTML=facts.map(f=>`
    <div class="funfact-item">
      <div class="funfact-icon" style="background:${f.bg};color:${f.color}"><i class="fas ${f.icon}"></i></div>
      <div>
        <div class="funfact-title">${f.title}</div>
        <div class="funfact-text">${f.text}</div>
      </div>
    </div>`).join('');
}

// ==============================
// PLAYER MODAL
// ==============================
window.openPlayerModal = nome => {
  const p = allPlayersData.find(pl=>pl.nome===nome); if(!p) return;
  const s=p.fifa;
  const card=document.getElementById('modal-card-container');
  card.className=`fut-card ${s.cssClass}`;
  document.getElementById('card-ovr').innerText=s.ovr;
  document.getElementById('card-pos').innerText=pos3(p.posicaoPref);
  document.getElementById('card-img').src=getPhoto(p.nome);
  document.getElementById('card-name').innerText=p.nomeOriginal.split(' ')[0];
  document.getElementById('stat-pac').innerText=s.pac; document.getElementById('stat-sho').innerText=s.sho;
  document.getElementById('stat-pas').innerText=s.pas; document.getElementById('stat-def').innerText=s.def;
  document.getElementById('stat-phy').innerText=s.phy; document.getElementById('stat-jog').innerText=p.jogos;
  document.getElementById('detail-name').innerText=p.nomeOriginal;
  document.getElementById('detail-level').innerText=p.nivel;
  document.getElementById('detail-media').innerText=p.notaGeral.toFixed(2);
  document.getElementById('detail-gols').innerText=p.gols;
  document.getElementById('detail-assist').innerText=p.assistencias;
  document.getElementById('detail-wins').innerText=p.vitorias;

  const recent=p.partidas.slice().reverse().slice(0,5);
  document.getElementById('detail-history').innerHTML=recent.map(m=>`
    <div class="player-history-row">
      <span class="history-date">${m.dataJogo}</span>
      <div class="history-badges">
        ${m.gols>0?`<span class="badge badge-g">${m.gols}G</span>`:''}
        ${m.assistencias>0?`<span class="badge badge-a">${m.assistencias}A</span>`:''}
        ${m.golsContra>0?`<span class="badge badge-gc">GC</span>`:''}
      </div>
      <span class="history-nota ${m.notaPartida>=8?'nota-high':m.notaPartida>=6?'nota-mid':'nota-low'}">${m.notaPartida.toFixed(1)}</span>
    </div>`).join('');

  document.getElementById('detail-badges').innerHTML=p.conquistas.length?
    p.conquistas.map(c=>`<span style="display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:6px;font-size:10px;font-family:var(--font-mono);border:1px solid var(--border);background:var(--surface2);color:var(--text2)"><i class="fas ${c.icon}" style="font-size:9px"></i>${c.nome}</span>`).join('')
    :'<span style="font-size:11px;color:var(--text3);font-style:italic">Nenhuma conquista ainda</span>';

  const ctx=document.getElementById('player-evo-chart');
  if(ctx){
    if(chartInstances['evo']) chartInstances['evo'].destroy();
    const ms=p.partidas.slice(-12);
    chartInstances['evo']=new Chart(ctx,{type:'line',data:{labels:ms.map(m=>m.dataJogo.substring(0,5)),datasets:[{data:ms.map(m=>m.notaPartida),borderColor:'#00e5ff',backgroundColor:'rgba(0,229,255,0.08)',borderWidth:2,pointRadius:3,pointBackgroundColor:'#00e5ff',fill:true,tension:0.35}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{min:4,max:10,grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#484f58',font:{size:9}}},x:{display:false}}}});
  }

  document.getElementById('player-modal').classList.remove('print-active');
  openModal('player-modal');
  // Scroll modal to top on open
  document.getElementById('player-modal').scrollTop = 0;
};

// ==============================
// MATCH MODAL
// ==============================
window.openMatchModal = date => {
  const matches=allMatchesData.filter(m=>m.dataJogo===date); if(!matches.length) return;
  const happened=matches.some(m=>m.jogoAconteceu);
  const boca=matches.filter(m=>m.time.toUpperCase().includes('BOCA')).sort((a,b)=>b.notaPartida-a.notaPartida);
  const river=matches.filter(m=>m.time.toUpperCase().includes('RIVER')).sort((a,b)=>b.notaPartida-a.notaPartida);
  let sA=0,sB=0;
  if(happened){
    sA=boca.reduce((a,b)=>a+b.gols,0)+river.reduce((a,b)=>a+b.golsContra,0);
    sB=river.reduce((a,b)=>a+b.gols,0)+boca.reduce((a,b)=>a+b.golsContra,0);
  }
  document.getElementById('match-date').innerText=`RESUMO · ${date}`;
  document.getElementById('score-a').innerText=happened?sA:'-';
  document.getElementById('score-b').innerText=happened?sB:'-';

  const posClass=p=>{ const pp=pos3(p.posicao).toLowerCase(); return `pos-${pp}`; };
  const renderList=team=>team.map(p=>`
    <div class="match-player-row" onclick="openPlayerModal('${p.nome}')">
      <span class="match-player-pos ${posClass(p)}">${pos3(p.posicao)}</span>
      <span class="match-player-name">${p.nomeRaw.split(' ')[0]}</span>
      ${happened?`<div class="match-player-badges">
        ${p.gols>0?`<span class="badge badge-g">${p.gols}G</span>`:''}
        ${p.assistencias>0?`<span class="badge badge-a">${p.assistencias}A</span>`:''}
        ${p.golsContra>0?`<span class="badge badge-gc">GC</span>`:''}
      </div>`:''}
      ${happened?`<span class="match-player-nota ${p.notaPartida>=8?'nota-high':p.notaPartida>=6?'nota-mid':'nota-low'}">${p.notaPartida.toFixed(1)}</span>`:''}
    </div>`).join('');

  document.getElementById('list-boca').innerHTML=renderList(boca);
  document.getElementById('list-river').innerHTML=renderList(river);

  let html='';
  if(happened){
    const renderP=(p,xPct,yPct)=>`<div class="pitch-player" style="left:${xPct}%;top:${yPct}%" onclick="openPlayerModal('${p.nome}')">
      <div class="pitch-player-img-wrap">
        <img src="${getPhoto(p.nome)}" class="pitch-player-img" style="width:34px;height:34px" onerror="this.src='${getPhoto(p.nome)}'">
        <div class="pitch-player-rating">${p.notaPartida.toFixed(1)}</div>
      </div>
      <div class="pitch-player-name">${p.nomeRaw.split(' ')[0]}</div>
    </div>`;
    const sel=[], is2026=date.endsWith('2026');
    const getPos=(posArr,count)=>matches.filter(p=>posArr.includes(p.posicao)&&!sel.includes(p.nome)).sort((a,b)=>b.notaPartida-a.notaPartida).slice(0,count);
    if(is2026){
      const gks=getPos(['gol'],1); gks.forEach(p=>sel.push(p.nome));
      const defs=getPos(['def','zag'],2); defs.forEach(p=>sel.push(p.nome));
      const meis=getPos(['mei','ala'],3); meis.forEach(p=>sel.push(p.nome));
      const atas=getPos(['ata'],1); atas.forEach(p=>sel.push(p.nome));
      if(gks[0]) html+=renderP(gks[0],50,88);
      if(defs[0]) html+=renderP(defs[0],28,68); if(defs[1]) html+=renderP(defs[1],72,68);
      if(meis[0]) html+=renderP(meis[0],50,48); if(meis[1]) html+=renderP(meis[1],18,48); if(meis[2]) html+=renderP(meis[2],82,48);
      if(atas[0]) html+=renderP(atas[0],50,14);
    } else {
      const getP=(pos,c)=>matches.filter(p=>p.posicao===pos&&!sel.includes(p.nome)).sort((a,b)=>b.notaPartida-a.notaPartida).slice(0,c);
      const gks=getP('gol',1),zag=getP('zag',1),ala=getP('ala',2),mei=getP('mei',1),ata=getP('ata',2);
      if(gks[0]) html+=renderP(gks[0],50,88);
      if(zag[0]) html+=renderP(zag[0],50,70);
      if(ala[0]) html+=renderP(ala[0],18,50); if(ala[1]) html+=renderP(ala[1],82,50);
      if(mei[0]) html+=renderP(mei[0],50,48);
      if(ata[0]) html+=renderP(ata[0],28,14); if(ata[1]) html+=renderP(ata[1],72,14);
    }
  } else {
    html='<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.7);padding:10px 20px;border-radius:8px;font-family:var(--font-mono);font-size:11px;color:var(--text3);letter-spacing:2px;border:1px solid var(--border)">AGUARDANDO</div>';
  }
  document.getElementById('match-team-display').innerHTML=html;
  document.getElementById('match-modal').classList.remove('print-active');
  openModal('match-modal');
};

// ==============================
// COMPARISON TOOL
// ==============================
function setupComparisonTool() {
  const p1=document.getElementById('p1-select'), p2=document.getElementById('p2-select');
  if(p1.options.length>1) return;
  const opts='<option value="">Selecione...</option>'+allPlayersData.sort((a,b)=>a.nomeOriginal.localeCompare(b.nomeOriginal)).map(p=>`<option value="${p.nome}">${p.nomeOriginal}</option>`).join('');
  p1.innerHTML=p2.innerHTML=opts;
  const compare=()=>{
    const pl1=allPlayersData.find(p=>p.nome===p1.value), pl2=allPlayersData.find(p=>p.nome===p2.value);
    const div=document.getElementById('comparison-content'), rc=document.getElementById('radar-container');
    if(!pl1||!pl2){div.innerHTML='<div style="text-align:center;color:var(--text3);padding:20px">Selecione dois jogadores.</div>';rc.style.display='none';return;}
    rc.style.display='flex';
    const stat=(l,v1,v2,dec=0)=>{
      const f=n=>typeof n==='number'?(dec>0?n.toFixed(dec):n):n;
      const w1=v1>=v2,w2=v2>=v1;
      return `<div class="compare-stat-row">
        <span class="compare-val ${w1?'winner':'loser'}">${f(v1)}</span>
        <span class="compare-label">${l}</span>
        <span class="compare-val ${w2?'winner':'loser'}">${f(v2)}</span>
      </div>`;
    };
    div.innerHTML=`<div style="display:grid;grid-template-columns:1fr auto 1fr;gap:16px;align-items:start;margin-bottom:24px">
      <div style="text-align:center"><img src="${getPhoto(pl1.nome)}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid var(--boca);margin-bottom:8px"><div style="font-family:var(--font-display);font-size:22px;letter-spacing:2px">${pl1.nomeOriginal.split(' ')[0]}</div><div style="font-family:var(--font-display);font-size:32px;color:var(--accent3)">${pl1.fifa.ovr}</div></div>
      <div style="font-family:var(--font-display);font-size:28px;color:var(--text3);padding-top:20px">VS</div>
      <div style="text-align:center"><img src="${getPhoto(pl2.nome)}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid var(--river);margin-bottom:8px"><div style="font-family:var(--font-display);font-size:22px;letter-spacing:2px">${pl2.nomeOriginal.split(' ')[0]}</div><div style="font-family:var(--font-display);font-size:32px;color:var(--accent3)">${pl2.fifa.ovr}</div></div>
    </div>
    <div style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);padding:16px">
      ${stat('JOGOS',pl1.jogos,pl2.jogos)}
      ${stat('GOLS',pl1.gols,pl2.gols)}
      ${stat('ASSISTÊNCIAS',pl1.assistencias,pl2.assistencias)}
      ${stat('G+A',pl1.ga,pl2.ga)}
      ${stat('NOTA GERAL',pl1.notaGeral,pl2.notaGeral,2)}
      ${stat('VITÓRIAS',pl1.vitorias,pl2.vitorias)}
      ${stat('APROVEITAMENTO %',pl1.aproveitamento,pl2.aproveitamento,1)}
    </div>`;

    const ctxR=document.getElementById('radar-chart');
    if(ctxR){
      if(chartInstances['radar']) chartInstances['radar'].destroy();
      chartInstances['radar']=new Chart(ctxR,{type:'radar',data:{labels:['PAC','SHO','PAS','DEF','PHY','TEC'],datasets:[
        {label:pl1.nomeOriginal.split(' ')[0],data:[pl1.fifa.pac,pl1.fifa.sho,pl1.fifa.pas,pl1.fifa.def,pl1.fifa.phy,Math.round(pl1.notaGeral*10)],borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.15)',pointBackgroundColor:'#3b82f6'},
        {label:pl2.nomeOriginal.split(' ')[0],data:[pl2.fifa.pac,pl2.fifa.sho,pl2.fifa.pas,pl2.fifa.def,pl2.fifa.phy,Math.round(pl2.notaGeral*10)],borderColor:'#ef4444',backgroundColor:'rgba(239,68,68,0.15)',pointBackgroundColor:'#ef4444'}
      ]},options:{maintainAspectRatio:false,scales:{r:{grid:{color:'rgba(255,255,255,0.08)'},pointLabels:{color:'#8b949e',font:{family:'Space Mono',size:9}},ticks:{display:false,backdropColor:'transparent'},angleLines:{color:'rgba(255,255,255,0.06)'},min:0,max:100}},plugins:{legend:{labels:{color:'#8b949e',font:{family:'Space Mono',size:9}}}}}});
    }
  };
  p1.onchange=p2.onchange=compare;
}

initData();
</script>
</body>
</html>
